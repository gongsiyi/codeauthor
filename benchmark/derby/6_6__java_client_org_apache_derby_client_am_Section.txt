1:33776ff: /*
2:33776ff:  *
1:33776ff:  * Derby - Class org.apache.derby.client.am.Section
1:33776ff:  *
1:59bf37d:  * Licensed to the Apache Software Foundation (ASF) under one or more
1:59bf37d:  * contributor license agreements.  See the NOTICE file distributed with
1:59bf37d:  * this work for additional information regarding copyright ownership.
1:59bf37d:  * The ASF licenses this file to You under the Apache License, Version 2.0
1:59bf37d:  * (the "License"); you may not use this file except in compliance with
1:59bf37d:  * the License.  You may obtain a copy of the License at
1:33776ff:  *
1:33776ff:  * http://www.apache.org/licenses/LICENSE-2.0
1:33776ff:  *
1:33776ff:  * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
1:33776ff:  * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
1:33776ff:  * specific language governing permissions and limitations under the License.
1:33776ff:  *
3:33776ff:  */
7:33776ff: 
1:33776ff: package org.apache.derby.client.am;
1:33776ff: 
1:69e3d06: import java.sql.ResultSet;
1:69e3d06: 
1:70f7692: public class Section {
1:33776ff: 
1:ee33904:     private int sectionNumber;
1:ee33904:     private String packageName;
1:ee33904:     private String serverCursorName; // As given by dnc package set
1:ee33904:     private int resultSetHoldability_;
1:33776ff: 
1:70f7692:     // Stores the package name and consistency token
1:ee33904:     private byte[] PKGNAMCBytes;
1:ee33904:     private boolean isGenerated; // flag to identify server generated sections
1:33776ff: 
1:ee33904:     private Agent agent_;
1:ee33904: 
1:ee33904: 
1:ee33904:     Section(Agent agent,
1:ee33904:             String name,
1:ee33904:             int sectionNumber,
1:ee33904:             String cursorName,
1:ee33904:             int resultSetHoldability) {
1:70f7692:         // default for all sections except for generated section , isGenerated is set to false
1:70f7692:         init(agent, name, sectionNumber, cursorName, resultSetHoldability, false);
17:33776ff:     }
1:33776ff: 
1:70f7692:     public Section(Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability, boolean isGenerated) {
1:70f7692:         init(agent, name, sectionNumber, cursorName, resultSetHoldability, isGenerated);
1:70f7692:     }
1:33776ff: 
1:70f7692:     private void init(Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability, boolean isGenerated) {
1:70f7692:         this.packageName = name;
1:70f7692:         this.sectionNumber = sectionNumber;
1:70f7692:         this.serverCursorName = cursorName;
1:70f7692:         resultSetHoldability_ = resultSetHoldability;
1:70f7692:         agent_ = agent;
1:70f7692:         this.isGenerated = isGenerated;
1:33776ff: 
1:70f7692:         // Store the packagename and consistency token bytes depending on the holdability
1:70f7692:         // PKGNAMCBytes will point to the appropriate byte array in SectionManager
1:70f7692:         // that stores the PKGNAMCBytes for reuse
1:70f7692:         // There are 2 byte arrays in SectionManager
1:70f7692:         // 1. holdPKGNAMCBytes which stores the PKGNAMCBytes when holdability is set
1:70f7692:         // 2. noHoldPKGNAMCBytes which stores the PKGNAMCBytes when holdability is non hold
1:70f7692:         // Note for generated sections, PKGNAMCBytes is generated by the server.
1:70f7692:         if (!isGenerated) {
1:70f7692:             if (resultSetHoldability_ == ResultSet.HOLD_CURSORS_OVER_COMMIT) {
1:70f7692:                 PKGNAMCBytes = agent_.sectionManager_.holdPKGNAMCBytes;
1:70f7692:             } else if (resultSetHoldability_ == ResultSet.CLOSE_CURSORS_AT_COMMIT) {
1:70f7692:                 PKGNAMCBytes = agent_.sectionManager_.noHoldPKGNAMCBytes;
1:70f7692:             }
1:70f7692:         }
1:70f7692:     }
1:70f7692: 
1:70f7692:     /**
1:95049cf:      * Store the Packagename and consistency token information for
1:95049cf:      * reuse.
1:95049cf:      * <ul>
1:95049cf:      *    <li>Case 1: if it is generated section, just store the byte
1:95049cf:      *        array in PKGNAMCBytes.</li>
1:95049cf:      *    <li>Case 2: for not a generated section, information is
1:95049cf:      *        stored in the correct byte array depending on the holdability
1:95049cf:      *        in SectionManager.</li>
1:95049cf:      * </ul>
1:0287682:      * @param b the Packagename and consistency token information to store;
1:95049cf:      *      should never be null.
1:70f7692:      */
1:70f7692:     public void setPKGNAMCBytes(byte[] b) {
1:70f7692:         if (isGenerated) {
1:95049cf:             PKGNAMCBytes = b.clone();
1:70f7692:         } else {
1:70f7692:             agent_.sectionManager_.setPKGNAMCBytes(b, resultSetHoldability_);
1:70f7692:         }
1:70f7692:     }
1:70f7692: 
1:70f7692:     /**
1:70f7692:      * retrieve the package name and consistency token information
1:70f7692:      */
1:70f7692:     public byte[] getPKGNAMCBytes() {
1:95049cf:         return PKGNAMCBytes != null ?
1:95049cf:                PKGNAMCBytes.clone() :
1:95049cf:                null;
1:70f7692:     }
1:70f7692: 
1:70f7692:     public String getPackageName() {
1:70f7692:         return this.packageName;
1:70f7692:     }
1:33776ff: 
1:33776ff: 
1:70f7692:     // Add a finalizer to free() the section, useful for Statement.executes that result in exceptions
1:33776ff: 
1:70f7692:     public int getSectionNumber() {
1:70f7692:         return this.sectionNumber;
1:70f7692:     }
1:33776ff: 
1:70f7692:     public String getPackage() {
1:70f7692:         return this.packageName;
1:70f7692:     }
1:33776ff: 
1:70f7692:     public String getServerCursorName() {
1:70f7692:         return this.serverCursorName;
1:70f7692:     }
1:33776ff: 
1:ee33904:     // member for positioned update sections only
1:ee33904:     String serverCursorNameForPositionedUpdate_ = null;
1:33776ff: 
1:70f7692:     public String getServerCursorNameForPositionedUpdate() {
1:70f7692:         return serverCursorNameForPositionedUpdate_;
1:70f7692:     }
1:33776ff: 
1:ee33904:     // ------------------------ transient members --------------------------------
1:ee33904: 
1:ee33904:     // As given by jdbc setCursorName(), this can change
1:ee33904:     transient private String clientCursorName_;
1:ee33904: 
1:70f7692:     public String getClientCursorName() {
1:70f7692:         return clientCursorName_;
1:70f7692:     }
1:33776ff: 
1:70f7692:     public void setClientCursorName(String clientCursorName) { //
1:70f7692:         //System.out.println("clientCursorName is set"+ clientCursorName);
1:70f7692:         this.clientCursorName_ = clientCursorName;
1:70f7692:     }
1:33776ff: 
1:ee33904:     void free() {
1:70f7692:         if (resultSetHoldability_ != -1) {
1:70f7692:             this.agent_.sectionManager_.freeSection(this, resultSetHoldability_);
1:70f7692:         }
1:70f7692:     }
1:33776ff: 
1:70f7692:     public boolean isReservedPositionedUpdate() {
1:70f7692:         return false;
1:70f7692:     }
1:33776ff: 
1:70f7692:     public int getStaticStatementType() {
1:70f7692:         return 0;
1:70f7692:     }
1:33776ff: 
1:d506170:     public Section getPositionedUpdateSection() throws SqlException {
1:70f7692:         return agent_.sectionManager_.getPositionedUpdateSection(this);
1:70f7692:     }
1:33776ff: 
1:70f7692:     public void setCursorName(String name) {
1:70f7692:         serverCursorName = name;
1:70f7692:     }
1:33776ff: 
1:33776ff: }
1:33776ff: 
============================================================================
author:Dag H. Wanvik
-------------------------------------------------------------------------------
commit:69e3d06
/////////////////////////////////////////////////////////////////////////
1: import java.sql.ResultSet;
1: 
commit:ee33904
/////////////////////////////////////////////////////////////////////////
1:     private int sectionNumber;
1:     private String packageName;
1:     private String serverCursorName; // As given by dnc package set
1:     private int resultSetHoldability_;
1:     private byte[] PKGNAMCBytes;
1:     private boolean isGenerated; // flag to identify server generated sections
1:     private Agent agent_;
1: 
1: 
1:     Section(Agent agent,
1:             String name,
1:             int sectionNumber,
1:             String cursorName,
1:             int resultSetHoldability) {
/////////////////////////////////////////////////////////////////////////
1:     // member for positioned update sections only
1:     String serverCursorNameForPositionedUpdate_ = null;
1:     // ------------------------ transient members --------------------------------
1: 
1:     // As given by jdbc setCursorName(), this can change
1:     transient private String clientCursorName_;
1: 
/////////////////////////////////////////////////////////////////////////
1:     void free() {
commit:95049cf
/////////////////////////////////////////////////////////////////////////
1:      * Store the Packagename and consistency token information for
1:      * reuse.
1:      * <ul>
1:      *    <li>Case 1: if it is generated section, just store the byte
1:      *        array in PKGNAMCBytes.</li>
1:      *    <li>Case 2: for not a generated section, information is
1:      *        stored in the correct byte array depending on the holdability
1:      *        in SectionManager.</li>
1:      * </ul>
0:      * @arg b the Packagename and consistency token information to store;
1:      *      should never be null.
1:             PKGNAMCBytes = b.clone();
/////////////////////////////////////////////////////////////////////////
1:         return PKGNAMCBytes != null ?
1:                PKGNAMCBytes.clone() :
1:                null;
author:Knut Anders Hatlen
-------------------------------------------------------------------------------
commit:0287682
/////////////////////////////////////////////////////////////////////////
1:      * @param b the Packagename and consistency token information to store;
author:Samuel Andrew McIntyre
-------------------------------------------------------------------------------
commit:59bf37d
/////////////////////////////////////////////////////////////////////////
1:  * Licensed to the Apache Software Foundation (ASF) under one or more
1:  * contributor license agreements.  See the NOTICE file distributed with
1:  * this work for additional information regarding copyright ownership.
1:  * The ASF licenses this file to You under the Apache License, Version 2.0
1:  * (the "License"); you may not use this file except in compliance with
1:  * the License.  You may obtain a copy of the License at
author:David Van Couvering
-------------------------------------------------------------------------------
commit:d506170
/////////////////////////////////////////////////////////////////////////
1:     public Section getPositionedUpdateSection() throws SqlException {
author:Jeremy Boynes
-------------------------------------------------------------------------------
commit:70f7692
/////////////////////////////////////////////////////////////////////////
1: public class Section {
0:     protected int sectionNumber;
0:     protected String packageName;
0:     protected String serverCursorName; // As given by dnc package set
0:     int resultSetHoldability_;
1:     // Stores the package name and consistency token
0:     byte[] PKGNAMCBytes;
0:     boolean isGenerated; // flag to identify server generated sections
0:     public Section(Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability) {
1:         // default for all sections except for generated section , isGenerated is set to false
1:         init(agent, name, sectionNumber, cursorName, resultSetHoldability, false);
1:     public Section(Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability, boolean isGenerated) {
1:         init(agent, name, sectionNumber, cursorName, resultSetHoldability, isGenerated);
1:     }
1:     private void init(Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability, boolean isGenerated) {
1:         this.packageName = name;
1:         this.sectionNumber = sectionNumber;
1:         this.serverCursorName = cursorName;
1:         resultSetHoldability_ = resultSetHoldability;
1:         agent_ = agent;
1:         this.isGenerated = isGenerated;
1:         // Store the packagename and consistency token bytes depending on the holdability
1:         // PKGNAMCBytes will point to the appropriate byte array in SectionManager
1:         // that stores the PKGNAMCBytes for reuse
1:         // There are 2 byte arrays in SectionManager
1:         // 1. holdPKGNAMCBytes which stores the PKGNAMCBytes when holdability is set
1:         // 2. noHoldPKGNAMCBytes which stores the PKGNAMCBytes when holdability is non hold
1:         // Note for generated sections, PKGNAMCBytes is generated by the server.
1:         if (!isGenerated) {
1:             if (resultSetHoldability_ == ResultSet.HOLD_CURSORS_OVER_COMMIT) {
1:                 PKGNAMCBytes = agent_.sectionManager_.holdPKGNAMCBytes;
1:             } else if (resultSetHoldability_ == ResultSet.CLOSE_CURSORS_AT_COMMIT) {
1:                 PKGNAMCBytes = agent_.sectionManager_.noHoldPKGNAMCBytes;
1:             }
1:         }
1:     }
1: 
1:     /**
0:      * Store the Packagename and consistency token information for reuse. Case 1: if it is generated section, just store
0:      * the byte array in PKGNAMCBytes Case 2: for not a generated section, information is stored in the correct byte
0:      * array depending on the holdability in SectionManager
1:      */
1:     public void setPKGNAMCBytes(byte[] b) {
1:         if (isGenerated) {
0:             PKGNAMCBytes = b;
1:         } else {
1:             agent_.sectionManager_.setPKGNAMCBytes(b, resultSetHoldability_);
1:         }
1:     }
1: 
1:     /**
1:      * retrieve the package name and consistency token information
1:      */
1:     public byte[] getPKGNAMCBytes() {
0:         return PKGNAMCBytes;
1:     }
1: 
1:     public String getPackageName() {
1:         return this.packageName;
1:     }
1:     // Add a finalizer to free() the section, useful for Statement.executes that result in exceptions
1:     public int getSectionNumber() {
1:         return this.sectionNumber;
1:     }
1:     public String getPackage() {
1:         return this.packageName;
1:     }
1:     public String getServerCursorName() {
1:         return this.serverCursorName;
1:     }
0:     // ------------------------ transient members --------------------------------
0:     public String serverCursorNameForPositionedUpdate_ = null; // member for positioned update sections only
0:     transient protected String clientCursorName_; // As given by jdbc setCursorName(), this can change
1:     public String getServerCursorNameForPositionedUpdate() {
1:         return serverCursorNameForPositionedUpdate_;
1:     }
1:     public String getClientCursorName() {
1:         return clientCursorName_;
1:     }
1:     public void setClientCursorName(String clientCursorName) { //
1:         //System.out.println("clientCursorName is set"+ clientCursorName);
1:         this.clientCursorName_ = clientCursorName;
1:     }
0:     protected Agent agent_;
0:     public void free() {
1:         if (resultSetHoldability_ != -1) {
1:             this.agent_.sectionManager_.freeSection(this, resultSetHoldability_);
1:         }
1:     }
1:     public boolean isReservedPositionedUpdate() {
1:         return false;
1:     }
1:     public int getStaticStatementType() {
1:         return 0;
1:     }
0:     public Section getPositionedUpdateSection() throws java.sql.SQLException {
1:         return agent_.sectionManager_.getPositionedUpdateSection(this);
1:     }
1:     public void setCursorName(String name) {
1:         serverCursorName = name;
1:     }
author:Satheesh E. Bandaram
-------------------------------------------------------------------------------
commit:33776ff
/////////////////////////////////////////////////////////////////////////
1: /*
1:  *
1:  * Derby - Class org.apache.derby.client.am.Section
1:  *
0:  * Copyright (c) 2001, 2005 The Apache Software Foundation or its licensors, where applicable.
1:  *
0:  * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
0:  * the License. You may obtain a copy of the License at
1:  *
1:  * http://www.apache.org/licenses/LICENSE-2.0
1:  *
1:  * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
1:  * an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
1:  * specific language governing permissions and limitations under the License.
1:  *
1:  */
1: 
1: package org.apache.derby.client.am;
1: 
0: public class Section
0: {
1: 
0:   protected int sectionNumber;
0:   protected String packageName;
0:   protected String serverCursorName; // As given by dnc package set
0:   int resultSetHoldability_;
1:   
0:   // Stores the package name and consistency token  
0:   byte[] PKGNAMCBytes; 
0:   boolean isGenerated; // flag to identify server generated sections
1: 
0:   public Section (Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability)
0:   {
0:      // default for all sections except for generated section , isGenerated is set to false
0:      init(agent,name,sectionNumber,cursorName,resultSetHoldability,false);
1:   }
1: 
0:   public Section (Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability,boolean isGenerated)
0:   {
0:      init(agent,name,sectionNumber,cursorName,resultSetHoldability,isGenerated);
1:   }
1: 
0:   private void init (Agent agent, String name, int sectionNumber, String cursorName, int resultSetHoldability,boolean isGenerated)
0:   {
0:     this.packageName = name;
0:     this.sectionNumber = sectionNumber;
0:     this.serverCursorName = cursorName;
0:     resultSetHoldability_ = resultSetHoldability;
0:     agent_ = agent;
0:     this.isGenerated = isGenerated;
1: 
0:     // Store the packagename and consistency token bytes depending on the holdability
0:     // PKGNAMCBytes will point to the appropriate byte array in SectionManager
0:     // that stores the PKGNAMCBytes for reuse
0:     // There are 2 byte arrays in SectionManager
0:     // 1. holdPKGNAMCBytes which stores the PKGNAMCBytes when holdability is set
0:     // 2. noHoldPKGNAMCBytes which stores the PKGNAMCBytes when holdability is non hold
0:     // Note for generated sections, PKGNAMCBytes is generated by the server.
0:     if(!isGenerated)
0:     {
0:        if (resultSetHoldability_ == ResultSet.HOLD_CURSORS_OVER_COMMIT)
0:    	  PKGNAMCBytes = agent_.sectionManager_.holdPKGNAMCBytes;
0:        else if (resultSetHoldability_ == ResultSet.CLOSE_CURSORS_AT_COMMIT)
0: 	  PKGNAMCBytes = agent_.sectionManager_.noHoldPKGNAMCBytes;
1:     }
1:   }
1: 
0:   /**
0:    *  Store the Packagename and consistency token information 
0:    *  for reuse. 
0:    *  Case 1: if it is generated section, just store the byte array in PKGNAMCBytes
0:    *  Case 2: for not a generated section, information is stored in the correct byte array
0:    *  depending on the holdability in SectionManager  
1:    */
0:   public void setPKGNAMCBytes(byte[] b)
0:   {
0:      if(isGenerated)
0:         PKGNAMCBytes = b;
0:      else 
0:         agent_.sectionManager_.setPKGNAMCBytes(b,resultSetHoldability_);
1:   }
1: 
0:   /**
0:    * retrieve the package name and consistency token information
1:    */
0:   public byte[] getPKGNAMCBytes()
0:   {
0:      return PKGNAMCBytes;
1:   }
1: 
0:   public String getPackageName() { return this.packageName; }
1: 
1: 
0:   // Add a finalizer to free() the section, useful for Statement.executes that result in exceptions
1: 
0:   public int getSectionNumber ()
0:   {
0:     return this.sectionNumber;
1:   }
1: 
0:   public String getPackage ()
0:   {
0:     return this.packageName;
1:   }
1: 
0:   public String getServerCursorName ()
0:   {
0:     return this.serverCursorName;
1:   }
1: 
0:   // ------------------------ transient members --------------------------------
1: 
0:   public String serverCursorNameForPositionedUpdate_ = null; // member for positioned update sections only
0:   transient protected String clientCursorName_; // As given by jdbc setCursorName(), this can change
1: 
0:   public String getServerCursorNameForPositionedUpdate ()
0:   {
0:     return serverCursorNameForPositionedUpdate_;
1:   }
1: 
0:   public String getClientCursorName ()
0:   {
0:     return clientCursorName_;
1:   }
1: 
0:   public void setClientCursorName (String clientCursorName)
0:   { //
0:     //System.out.println("clientCursorName is set"+ clientCursorName);
0:     this.clientCursorName_ = clientCursorName;
1:   }
1: 
0:   protected Agent agent_;
1: 
1: 
0:   public void free ()
0:   {
0:     if (resultSetHoldability_ != -1)
0:       this.agent_.sectionManager_.freeSection(this, resultSetHoldability_);
1:   }
1: 
0:   public boolean isReservedPositionedUpdate ()
0:   {
0:     return false;
1:   }
1: 
0:   public int getStaticStatementType ()
0:   {
0:     return 0;
1:   }
1: 
0:   public Section getPositionedUpdateSection () throws java.sql.SQLException
0:   {
0:     return agent_.sectionManager_.getPositionedUpdateSection (this);
1:   }
1: 
0:   public void setCursorName (String name)
0:   {
0:     serverCursorName = name;
1:   }
1: 
1: }
1: 
============================================================================