2:fe9e3d4: /**
1:3d7c3d5:  *  Derby - Class org.apache.derbyTesting.functionTests.tests.lang.AutoIncrementTest
1:3d7c3d5:  *  
1:3d7c3d5:  * Licensed to the Apache Software Foundation (ASF) under one
1:3d7c3d5:  * or more contributor license agreements.  See the NOTICE file
1:3d7c3d5:  * distributed with this work for additional information
1:3d7c3d5:  * regarding copyright ownership.  The ASF licenses this file
1:3d7c3d5:  * to you under the Apache License, Version 2.0 (the
1:3d7c3d5:  * "License"); you may not use this file except in compliance
1:3d7c3d5:  * with the License.  You may obtain a copy of the License at
1:3d7c3d5:  *
1:3d7c3d5:  *   http://www.apache.org/licenses/LICENSE-2.0
1:3d7c3d5:  *
1:3d7c3d5:  * Unless required by applicable law or agreed to in writing,
1:3d7c3d5:  * software distributed under the License is distributed on an
1:3d7c3d5:  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
1:3d7c3d5:  * KIND, either express or implied.  See the License for the
1:3d7c3d5:  * specific language governing permissions and limitations
1:3d7c3d5:  * under the License.
2:fe9e3d4:  */
27:3d7c3d5: 
1:3d7c3d5: package org.apache.derbyTesting.functionTests.tests.lang;
1:fe9e3d4: 
1:3d7c3d5: import java.sql.Connection;
1:3d7c3d5: import java.sql.PreparedStatement;
1:3d7c3d5: import java.sql.ResultSet;
1:3d7c3d5: import java.sql.SQLException;
1:3d7c3d5: import java.sql.Statement;
1:3d7c3d5: import junit.framework.Test;
1:3d7c3d5: import org.apache.derbyTesting.junit.BaseJDBCTestCase;
1:1ae02c9: import org.apache.derbyTesting.junit.BaseTestSuite;
1:3d7c3d5: import org.apache.derbyTesting.junit.CleanDatabaseTestSetup;
1:3d7c3d5: import org.apache.derbyTesting.junit.JDBC;
1:fe9e3d4: 
1:3d7c3d5: public class AutoIncrementTest extends BaseJDBCTestCase {
1:3d7c3d5: 	public AutoIncrementTest(String name)
1:fe9e3d4: 	{
1:3d7c3d5: 		super (name);
1:fe9e3d4: 	}
1:fe9e3d4: 	/**
1:3d7c3d5: 	 * converted from autoincrement.sql.  
1:3d7c3d5: 	 * @throws SQLException
1:fe9e3d4: 	 */
1:3d7c3d5: 	private static void createSchemaObjects(Statement st)
1:3d7c3d5: 	throws SQLException
1:fe9e3d4: 	{
1:729be57: 		
1:3d7c3d5: 		st.executeUpdate("create table ai_zero (i int, a_zero int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table ai_one (i int, a_one smallint generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table ai_two (i int, a_two int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table ai_three (i int, a_three int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table ai (i  int, autoinc int generated always as identity (start with 100))");
1:3d7c3d5: 		st.executeUpdate("create table ai1 (i int, autoinc1 int generated always as identity (increment by 100))");
1:3d7c3d5: 		st.executeUpdate("create table ai2 (i int,autoinc2 int generated always as identity (start with 101, increment by 100))"); 
1:3d7c3d5: 		st.executeUpdate("create table ai3 (i int,a11 int generated always as identity (start with  0, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table ai4 (i int,a21 int generated always as identity (start with  +0, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table ai5 (i int, a31 int generated always as identity (start with  -1, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table ai6 (i int, a41 int generated always as identity (start with  -11, increment by +100))");
1:3d7c3d5: 		//-- **** simple increment tests.
1:3d7c3d5: 		st.executeUpdate("create table ai_short (i int,ais smallint generated always as identity (start with 0, increment by 2))");
1:3d7c3d5: 		st.executeUpdate("create table ai_single1 (i int, a0 int generated always as identity (start with  -1, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table ai_single2 (i int, a1 smallint generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table ai_single3 (i int, a2 int generated always as identity (start with 0))");
1:3d7c3d5: 		st.executeUpdate("create table ai_single4 (i int, a3 bigint generated always as identity(start with  -100, increment by 10))");
1:729be57: 
1:3d7c3d5: 
1:3d7c3d5: 		st.executeUpdate("create table ai_test (x int generated always as identity (start with 2, increment by 2),y int)");
1:3d7c3d5: 
1:3d7c3d5: 		st.executeUpdate("create table ai_single1conn (c char(100), a_odd int generated always as identity (start with 1, increment by 2))");
1:3d7c3d5: 		st.executeUpdate("create table ai_single2conn (c char(100), a_even int generated always as identity (start with 0, increment by 2))");
1:3d7c3d5: 		st.executeUpdate("create table ai_single3conn (c char(100), a_sum bigint generated always as identity (start with 1, increment by 2))");
1:3d7c3d5: 		
1:3d7c3d5: 		//-- triggers 
1:3d7c3d5: 		st.executeUpdate("create table t1 (c1 int generated always as identity, name char(32))");
1:3d7c3d5: 		st.executeUpdate("create table t2 (c2 int generated always as identity, name char(32))");
1:3d7c3d5: 		st.executeUpdate("create trigger insert_trigger after insert on t1 for each row insert into t2 (name) values ('Bob Finocchio')");		
1:3d7c3d5: 		st.executeUpdate("create table tab1(s1 int generated always as identity,lvl int)");
1:3d7c3d5: 		st.executeUpdate("create table tab3 (c1 int)");
1:3d7c3d5: 		st.executeUpdate("create trigger tab1_after1 after insert on tab3 referencing new as newrow for each row insert into tab1 (lvl) values 1,2,3");
1:3d7c3d5: 		st.executeUpdate("create table tab1schema (i int, a1 int generated always as identity (start with -1, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table tab2schema (i int, a2 smallint generated always as identity (start with 1, increment by +1))");
1:3d7c3d5: 		st.executeUpdate("create table tab3schema (i int, a1 int generated always as identity (start with 0, increment by -2))");
1:3d7c3d5: 		st.executeUpdate("create table tab4schema (i int, a2 bigint generated always as identity (start with 0, increment by 2))");		
1:3d7c3d5: 
1:3d7c3d5: 		st.executeUpdate("create table t1_1 (x int, s1 int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table t2_1 (x smallint, s2 int generated always as identity (start with 0))");
1:3d7c3d5: 		st.executeUpdate("create table t1_2 (s1 int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("alter table t1_2 add column x int");		
1:3d7c3d5: 		st.executeUpdate("create table t2_2 (s2 int generated always as identity (start with 2))");
1:3d7c3d5: 		st.executeUpdate("alter table t2_2 add column x int");
1:3d7c3d5: 		st.executeUpdate("create table t3_2 (s0 int generated always as identity (start with 0))");
1:3d7c3d5: 		st.executeUpdate("alter table t3_2 add column x int");
1:3d7c3d5: 		//-- test some more generated column specs
1:3d7c3d5: 		st.executeUpdate("create table trigtest (s1 smallint generated always as identity, lvl int)");
1:3d7c3d5: 		st.executeUpdate("create table t1_col (x char(2) default 'yy', y bigint generated always as identity)");
1:3d7c3d5: 		//conn.setAutoCommit(false);
1:3d7c3d5: 		st.executeUpdate("create table testme (text varchar(10), autonum int generated always as identity)");
1:3d7c3d5: 		//conn.commit();		
1:3d7c3d5: 		st.executeUpdate("create table ai_neg (x smallint generated always as identity, y int)");
1:3d7c3d5: 		st.executeUpdate("create table ai_over1 (x int, y int generated always as identity (increment by 200000000))");
1:3d7c3d5: 		st.executeUpdate("create table ai_over2 (x int, y smallint generated always as identity (start with  -32760, increment by -1))");
1:3d7c3d5: 		st.executeUpdate("create table ai_over3 (x int, y int generated always as identity (start with  2147483646))");
1:3d7c3d5: 		st.executeUpdate("create table ai_over4 (x int, y bigint generated always as identity(start with     9223372036854775805))");
1:3d7c3d5: 		st.executeUpdate("create table base (x int)");
1:3d7c3d5: 		// testing non-reserved keywords: generated, start, always
1:3d7c3d5: 		// should be successful
1:3d7c3d5: 		st.executeUpdate("create table always (a int)");
1:3d7c3d5: 		st.executeUpdate("create table start (a int)");
1:3d7c3d5: 		st.executeUpdate("create table generated (a int)");
1:3d7c3d5: 		st.executeUpdate("create table idt1(c1 int generated always as identity, c2 int)");
1:3d7c3d5: 		st.executeUpdate("create table autoinct2 (a int, b int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table autoinct1(c1 int generated always as identity)");
1:3d7c3d5: 		st.executeUpdate("create table autoinct3(c1 int generated always as identity (increment by 3))");
1:3d7c3d5: 		st.execute("create table withinct1(i int, withinct1_autogen int generated always as identity)");
1:3d7c3d5: 		st.execute("create table withinct2(i int, withinct2_autogen int generated by default as identity)");
1:3d7c3d5: 		st.execute("create table withinctempt1(i int, withinct1_autogen int generated always as identity)");
1:3d7c3d5: 		st.execute("create table withinctempt2(i int, withinct2_autogen int generated by default as identity)");
1:3d7c3d5: 		st.execute("create table withinct3(i int, withinct3_autogen int generated always as identity(increment by 10))");
1:3d7c3d5: 		st.execute("create table withinct4(i int, withinct4_autogen int generated by default as identity(increment by 10))");
1:3d7c3d5: 		st.execute("create table variantt1 (c11 int generated always as identity (start with 101, increment by 3), c12 int)");
1:3d7c3d5: 		st.execute("create table variantt2 (c21 int generated always as identity (start with 201, increment by 5), c22 int)");
1:3d7c3d5: 		st.execute("create trigger variantt1tr1 after insert on variantt1 for each row insert into variantt2 (c22) values (1)");
1:3d7c3d5: 		st.execute("create table restartt1 (rec11 int generated by default as identity(start with 2, increment by 2), c12 int)");
1:3d7c3d5: 		st.execute("create table t1lock(lockc11 int generated by default as identity (start with 1, increment by 1), c12 int)");
1:3d7c3d5: 		st.execute("create unique index t1locki1 on t1lock(lockc11)");
1:3d7c3d5: 		//-- Since RESTART is not a reserved keyword, we should be able to create a table with name RESTART
1:3d7c3d5: 		st.execute("create table restart (c11 int)");
1:3d7c3d5: 		st.execute("create table newTable (restart int)");
1:3d7c3d5: 		st.execute("create table newTable2 (c11 int)");
1:3d7c3d5: 		st.execute("alter table newTable2 add column RESTART int");
1:3d7c3d5: 		st.execute("CREATE TABLE DERBY_1495 (testid INT GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) NOT NULL,testcol2 INT NOT NULL)");
1:3d7c3d5: 		st.execute("create table derby_1645 (testTableId INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,testStringValue VARCHAR(20) not null,constraint PK_derby_1645 primary key (testTableId))");
1:3d7c3d5: 		st.execute("create table D1644 (d1644c1 int, d1644c2 int generated by default as identity)");
1:3d7c3d5: 		st.execute("create table D1644_A (d1644_Ac1 int, d1644_Ac2 int generated by default as identity, c3 int)");
1:3d7c3d5: 		st.execute("create table D1644_B (d1644_Bc1 int generated by default as identity)");
1:3d7c3d5: 		st.execute("create table d4006 (x varchar(5) default 'abc')");
1:3d7c3d5: 		st.execute("create table d4006_a (z int generated always as identity)");
1:3d7c3d5: 		st.execute("create table d4419_t1(x int)");
1:3d7c3d5: 		st.execute("insert into d4419_t1 values 1,2");
1:3d7c3d5: 		st.execute("create table d4419_t2(x int)");
1:3d7c3d5: 		st.execute("insert into d4419_t2 values 2,3");
1:3d7c3d5: 		st.execute("create table d4419_t3(x int, y int generated always as identity)");
1:3d7c3d5: 		st.execute("insert into d4419_t3(x) select * from d4419_t1 union select * from d4419_t2");
1:3d7c3d5: 		st.execute("create table lockt1 (x int, yyyy int generated always as identity (start with  0))");
1:3d7c3d5: 		st.execute("create view lock_table as select cast(username as char(8)) as username, cast(t.type as char(8)) as trantype,cast(l.type as char(8)) as type, cast(lockcount as char(3)) as cnt, mode, cast(tablename as char(12)) as tabname,state, status from  syscs_diag.lock_table l right outer join syscs_diag.transaction_table t on l.xid = t.xid  where t.type='UserTransaction' and l.lockcount is not null");
1:3d7c3d5: 		st.execute("create table uniquet1(i int, t1_autogen int generated always as identity(start with 100, increment by 20))");
1:3d7c3d5: 		st.execute("create table uniquet2(i int, t2_autogen int generated by default as identity(start with 100, increment by 20))");
1:3d7c3d5: 		st.execute("create table uniquetempt1(i int, t1_autogen int generated always as identity(start with 100, increment by 20))");
1:3d7c3d5: 		st.execute("create table uniquetempt2(i int, t2_autogen int generated by default as identity(start with 100, increment by 20))");
1:3d7c3d5: 		st.execute("create table uniquet3(i int,uniquet3_autogen int generated by default as identity(start with 0, increment by 1) unique)");
1:3d7c3d5: 		st.execute("create table uniquet4(i int,uniquet4_autogen int generated by default as identity(start with 0, increment by 1))");
1:3d7c3d5: 		st.execute("create unique index idx_uniquet4_autogen on uniquet4(uniquet4_autogen)");
1:3d7c3d5: 		st.execute("create table withinctempt3(i int, t1_autogen int generated always as identity(increment by 10))");
1:3d7c3d5: 		st.execute("create table withinctempt4(i int, t2_autogen int generated by default as identity(increment by 10))");
9:3d7c3d5: 	}
1:3d7c3d5: 	public void testderbyIncrementTest() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:fe9e3d4: 		Statement s = createStatement();
1:0ee1994: 		rs = s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME in ('A_ZERO','A_ONE', 'A_TWO', 'A_THREE') order by COLUMNNAME");
1:0ee1994: 		String [][]expectedRows=
1:0ee1994:             {
1:0ee1994: 				{"A_ONE","1","1","1"},
1:0ee1994:                 {"A_THREE","1","1","1"},
1:0ee1994:                 {"A_TWO","1","1","1"},
1:0ee1994:                 {"A_ZERO","1","1","1"},
1:0ee1994:             };
6:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:fe9e3d4: 	}
1:3d7c3d5: 	public void testautoIncSysColTest()  throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		String [][]expectedRows;
1:fe9e3d4: 		
4:3d7c3d5: 		Statement s = createStatement();
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC'");
1:3d7c3d5: 		expectedRows=new String[][]{{"100","100","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC1'");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1","100"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC2'");
1:3d7c3d5: 		expectedRows=new String[][]{{"101","101","100"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 	}
1:3d7c3d5: 	public void testnegative() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		//-- try -ive numbers.
1:3d7c3d5: 		ResultSet rs;
1:fe9e3d4: 		
1:fe9e3d4: 		
1:3d7c3d5: 		Statement s = createStatement();
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A11'");
1:3d7c3d5: 		String [][]expectedRows=new String[][]{{"0","0","-1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A21'");
1:3d7c3d5: 		expectedRows=new String[][]{{"0","0","-1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A31'");
1:3d7c3d5: 		expectedRows=new String[][]{{"-1","-1","-1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A41'");
1:3d7c3d5: 		expectedRows=new String[][]{{"-11","-11","100"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	
1:3d7c3d5: 	public void testsimpleincrement() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		/*change*/
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s = createStatement();
1:3d7c3d5: 		s.executeUpdate("insert into ai_short (i) values (0)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_short (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_short (i) values (2)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_short (i) values (33)");
1:0ee1994: 		rs = s.executeQuery("select * from ai_short order by i");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"0","0"},{"1","2"},{"2","4"},{"33","6"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287:         vetSequenceState( "ai_short", 8, 0, 2 );
1:3d7c3d5: 	}
1:a180287:     private void    vetSequenceState( String tableName, long currentValue, long startValue, long stepValue )
1:a180287:         throws Exception
1:a180287:     {
1:a180287:         Connection  conn = getConnection();
1:a180287:         String  sequenceName = IdentitySequenceTest.getIdentitySequenceName( conn, tableName );
1:a180287:         ResultSet   rs = conn.prepareStatement
1:a180287:             (
1:a180287:              "select s.startValue, s.increment\n" +
1:a180287:              "from sys.syssequences s\n" +
1:a180287:              "where sequenceName = '" + sequenceName + "'"
1:a180287:              ).executeQuery();
1:a180287:         String[][]  expectedRows = new String[][]
1:a180287:         {
1:a180287:             { Long.toString( startValue ), Long.toString( stepValue ) }
1:a180287:         };
1:a180287:         JDBC.assertFullResultSet( rs,expectedRows );
1:a180287: 
1:a180287:         rs = conn.prepareStatement
1:a180287:             (
1:a180287:              "values syscs_util.syscs_peek_at_identity( 'APP', '" + tableName.toUpperCase() + "' )"
1:a180287:              ).executeQuery();
1:a180287:         expectedRows = new String[][] { { Long.toString( currentValue ) } };
1:a180287:         JDBC.assertFullResultSet( rs,expectedRows );
1:a180287:     }
1:3d7c3d5: 	public void testonegeneratedcolumn() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		//-- table with one generated column spec should succeed
1:3d7c3d5: 		ResultSet rs;
1:fe9e3d4: 		Statement s = createStatement();
1:39b3237: 		Integer i= 1;
1:fe9e3d4: 
1:3d7c3d5: 		while (i.intValue()< 11)
1:fe9e3d4: 		{
1:3d7c3d5: 			String mysql="insert into ai_single1 (i) values ("+i.toString()+")";
1:3d7c3d5: 			s.executeUpdate(mysql);
1:3d7c3d5: 			mysql="insert into ai_single2 (i) values ("+i.toString()+")";
1:3d7c3d5: 			s.executeUpdate(mysql);
1:3d7c3d5: 			mysql="insert into ai_single3 (i) values ("+i.toString()+")";
1:3d7c3d5: 			s.executeUpdate(mysql);
1:3d7c3d5: 			mysql="insert into ai_single4 (i) values ("+i.toString()+")";
1:3d7c3d5: 			s.executeUpdate(mysql);
1:3d7c3d5: 			int j=i.intValue()+1;
1:39b3237: 			i= j;
1:fe9e3d4: 		}
1:0ee1994: 		rs = s.executeQuery("select a.i, a0, a1, a2, a3 from ai_single1 a join ai_single2 b on a.i = b.i join ai_single3 c on a.i = c.i join ai_single4 d on a.i = d.i order by a.i");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","-1","1","0","-100"},{"2","-2","2","1","-90"},
1:3d7c3d5: 				{"3","-3","3","2","-80"},{"4","-4","4","3","-70"},
1:3d7c3d5: 				{"5","-5","5","4","-60"},{"6","-6","6","5","-50"},
1:3d7c3d5: 				{"7","-7","7","6","-40"},{"8","-8","8","7","-30"},
1:3d7c3d5: 				{"9","-9","9","8","-20"},{"10","-10","10","9","-10"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("delete from ai_single1");
1:3d7c3d5: 		s.executeUpdate("delete from ai_single2");
1:3d7c3d5: 		s.executeUpdate("delete from ai_single3");
1:3d7c3d5: 		s.executeUpdate("delete from ai_single4");
1:3d7c3d5: 		s.executeUpdate("insert into ai_single1 (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_single2 (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_single3 (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_single4 (i) values (1)");
1:3d7c3d5: 		rs=s.executeQuery("select a.i, a0, a1, a2, a3 from ai_single1 a join ai_single2 b on a.i = b.i join ai_single3 c on a.i = c.i join ai_single4 d on a.i = d.i");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","-11","11","10","0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		//-- table with more than one generated column spec should fail
1:3d7c3d5: 		assertStatementError("428C1", s,"create table ai_multiple (i int, a0 int generated always as identity (start with  -1,increment by -1),a1 smallint generated always as identity,a2 int generated always as identity (start with  0),a3 bigint generated always as identity (start with  -100,increment by 10))");
1:fe9e3d4: 
1:fe9e3d4: 	}
1:3d7c3d5: 	public void testConnectionInfo() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		//-- **** connection info tests {basic ones}
1:3d7c3d5: 		ResultSet rs;
1:fe9e3d4: 		Statement s = createStatement();
1:3d7c3d5: 		s.executeUpdate("insert into ai_test (y) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{null}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_test (y) select y+10 from ai_test");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");		
1:3d7c3d5: 		//-- try some more connection info tests
1:3d7c3d5: 		expectedRows=new String[][]{{null}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single1conn (c) values ('a')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single2conn (c) values ('a')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single3conn (c) values ('a')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single1conn (c) values ('b')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single2conn (c) values ('b')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into ai_single3conn (c) values ('b')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:fe9e3d4: 	}
1:3d7c3d5: 	public void testTrigger() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.executeUpdate("insert into t1 (name) values ('Phil White')");
1:3d7c3d5: 		rs=s.executeQuery("select * from t1");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","Phil White"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select * from t2");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","Bob Finocchio"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t2 (name) values ('Jean-Yves Dexemier')");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 		
1:fe9e3d4: 	}
1:3d7c3d5: 	public void testSchema() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		//-- insert into multiple tables in different schema names with same tablename,column names
1:3d7c3d5: 		//-- make sure 
1:3d7c3d5: 		//-- lastAutoincrementValue shouldn't get confused.....
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.executeUpdate("create schema BPP");
1:3d7c3d5: 		s.executeUpdate("set schema BPP");
1:3d7c3d5: 		s.executeUpdate("create table tab1schema (i int, a1 int generated always as identity (start with 100, increment by 1))");
1:3d7c3d5: 		s.executeUpdate("create table tab2schema (i int, a2 bigint generated always as identity (start with 100, increment by -1))");
1:3d7c3d5: 		s.executeUpdate("create table tab3schema (i int, a1 int generated always as identity (start with 100, increment by 2))");
1:3d7c3d5: 		s.executeUpdate("create table tab4schema (i int, a2 smallint generated always as identity (start with 100, increment by -2))");
1:3d7c3d5: 		s.executeUpdate("insert into APP.tab1schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into APP.tab2schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into APP.tab3schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into APP.tab4schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into tab1schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into tab1schema (i) values (2)");
1:3d7c3d5: 		s.executeUpdate("insert into tab2schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into tab2schema (i) values (2)");
1:3d7c3d5: 		s.executeUpdate("insert into tab3schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into tab3schema (i) values (2)");
1:3d7c3d5: 		s.executeUpdate("insert into tab4schema (i) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into tab4schema (i) values (2)");
1:3d7c3d5: 		rs=s.executeQuery("select a.i, a1, a2 from app.tab1schema a join app.tab2schema b on a.i = b.i");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","-1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select a.i, a1, a2 from app.tab3schema a join app.tab4schema b on a.i = b.i");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0","0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:0ee1994: 		rs=s.executeQuery("select a.i, a1, a2 from tab1schema a join tab2schema b on a.i = b.i order by a.i");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","100","100"},{"2","101","99"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:0ee1994: 		rs=s.executeQuery("select a1, a2, a.i from tab3schema a join tab4schema b on a.i = b.i order by a1");
1:3d7c3d5: 		expectedRows=new String[][]{{"100","100","1"},{"102","98","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"98"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("set schema APP");
1:3d7c3d5: 		s.executeUpdate("drop table BPP.tab1schema");
1:3d7c3d5: 		s.executeUpdate("drop table BPP.tab2schema");
1:3d7c3d5: 		s.executeUpdate("drop table BPP.tab3schema");
1:3d7c3d5: 		s.executeUpdate("drop table BPP.tab4schema");
1:3d7c3d5: 		s.executeUpdate("drop schema BPP restrict");
1:3d7c3d5: 		s.executeUpdate("insert into tab3 values null");
1:0ee1994: 		rs=s.executeQuery("select * from tab1 order by s1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"2","2"},{"3","3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287:         vetSequenceState( "TAB1", 4, 1, 1 );
1:3d7c3d5: 		s.executeUpdate("create table tab2 (lvl int, s1  bigint generated always as identity)");
1:3d7c3d5: 		s.executeUpdate("create trigger tab1_after2 after insert on tab3 referencing new as newrow for each row insert into tab2 (lvl) values 1,2,3");
1:3d7c3d5: 		s.executeUpdate("insert into tab3 values null");
1:0ee1994: 		rs=s.executeQuery("select * from tab2 order by lvl");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"2","2"},{"3","3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287:         vetSequenceState( "TAB2", 4, 1, 1 );
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testadditionalSysCol() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.executeUpdate("insert into t1_1 (x) values (1)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t1_1 (x) values (2)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t2_1 (x) values (1)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1:3d7c3d5: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");		
1:3d7c3d5: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
1:0ee1994: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1","2","0"},{"2","2","3","1"},{"3","3","4","2"},{"4","4","5","3"},{"5","5","6","4"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into trigtest (lvl) values (0)");
1:3d7c3d5: 		s.executeUpdate("insert into trigtest (lvl) values (1),(2)");
1:3d7c3d5: 		s.executeUpdate("insert into trigtest (lvl) values (3),(4)");
1:3d7c3d5: 		s.executeUpdate("insert into trigtest (lvl) values (5),(6)");
1:3d7c3d5: 		s.executeUpdate("insert into trigtest (lvl) values (7),(8)");
1:0ee1994: 		rs=s.executeQuery("select * from trigtest order by s1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"5","4"},{"6","5"},{"7","6"},{"8","7"},{"9","8"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select count(*) from t1_2");
1:3d7c3d5: 		expectedRows=new String[][]{{"5"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("delete from t1_2");
1:3d7c3d5: 		s.executeUpdate("delete from t2_2");
1:3d7c3d5: 		s.executeUpdate("delete from t3_2");
1:3d7c3d5: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1:3d7c3d5: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");
1:3d7c3d5: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
1:0ee1994: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","6","7","5"},{"2","7","8","6"},{"3","8","9","7"},{"4","9","10","8"},{"5","10","11","9"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t1_2 (x) values (6)");
1:3d7c3d5: 		s.executeUpdate("insert into t2_2 (x) values (6)");
1:3d7c3d5: 		s.executeUpdate("insert into t3_2 (x) values (6)");
1:0ee1994: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2  a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","6","7","5"},{"2","7","8","6"},{"3","8","9","7"},{"4","9","10","8"},{"5","10","11","9"},{"6","11","12","10"}};
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"10"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("delete from t1_2");
1:3d7c3d5: 		s.executeUpdate("delete from t2_2");
1:3d7c3d5: 		s.executeUpdate("delete from t3_2");
1:3d7c3d5: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1:3d7c3d5: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");
1:3d7c3d5: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
1:0ee1994: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","12","13","11"},{"2","13","14","12"},{"3","14","15","13"},{"4","15","16","14"},{"5","16","17","15"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into t1_2 (x) values (6)");
1:3d7c3d5: 		s.executeUpdate("insert into t2_2 (x) values (6)");
1:3d7c3d5: 		s.executeUpdate("insert into t3_2 (x) values (6)");
1:0ee1994: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","12","13","11"},{"2","13","14","12"},{"3","14","15","13"},{"4","15","16","14"},{"5","16","17","15"},{"6","17","18","16"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"16"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testsyslocks()throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		setAutoCommit(false);
1:3d7c3d5: 		s.execute("insert into lockt1 (x) values (1)");
1:3d7c3d5: 		s.execute("insert into lockt1 (x) values (2)");
1:0ee1994: 		rs=s.executeQuery("select * from lockt1 order by x");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","0"},{"2","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:0ee1994: 		rs=s.executeQuery("select * from lock_table order by username, trantype, type, cnt");
2:3d7c3d5: 		//Utilities.showResultSet(rs);
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:0ee1994:                 {"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:0ee1994:                 {"APP   ","UserTran","TABLE   ","2  ","IX","LOCKT1      ","GRANT","ACTIVE"},
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("delete from lockt1");
1:3d7c3d5: 		commit();
2:3d7c3d5: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
1:3d7c3d5: 		expectedRows=new String[][]{};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("set isolation serializable");
1:3d7c3d5: 		rs=s.executeQuery("select columnname, autoincrementvalue from sys.syscolumns where columnname = 'YYYY'");
1:a180287: 		expectedRows=new String[][]
1:a180287:             {
1:a180287:                 {"APP     ","UserTran","TABLE   ","1   ","S   ","SYSCOLUMNS  ","GRANT","ACTIVE"}
1:a180287:             };
1:3d7c3d5: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
1:a180287: 		expectedRows=new String[][]
1:a180287:             {
1:a180287:                 {"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"}
1:a180287:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into lockt1 (x) values (3)");
1:3d7c3d5: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
1:a180287: 		expectedRows=new String[][]
1:a180287:             {
1:a180287:                 {"APP     ","UserTran","TABLE   ","1  ","IX","LOCKT1      ","GRANT","ACTIVE"},
1:a180287:                 {"APP     ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:a180287:                 {"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"},
1:a180287:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		commit();
1:fe9e3d4: 		
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testColoumnSpecs() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:fe9e3d4: 		
1:fe9e3d4: 		
1:3d7c3d5: 		s.executeUpdate("insert into t1_col (x, y) values ('aa', default)");
1:3d7c3d5: 		s.executeUpdate("insert into t1_col values ('bb', default)");
1:3d7c3d5: 		s.executeUpdate("insert into t1_col (x) values default");
1:3d7c3d5: 		s.executeUpdate("insert into t1_col (x) values null");
1:3d7c3d5: 		//-- switch the order of the columns
1:3d7c3d5: 		s.executeUpdate("insert into t1_col (y, x) values (default, 'cc')");
1:0ee1994: 		rs=s.executeQuery("select * from t1_col order by y");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"aa","1"},{"bb","2"},{"yy","3"},{null,"4"},{"cc","5"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:fe9e3d4: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testbug3450() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		PreparedStatement ps=prepareStatement("insert into testme (text) values ?");
1:3d7c3d5: 		//PreparedStatement ps=conn.prepareStatement();
1:3d7c3d5: 		ps.setString(1, "one");
1:3d7c3d5: 		ps.execute();
1:3d7c3d5: 		ps.setString(1, "two");;
1:3d7c3d5: 		ps.execute();
1:3d7c3d5: 		ps.setString(1, "three");;
1:3d7c3d5: 		ps.execute();
1:0ee1994: 		rs=s.executeQuery("select * from testme order by autonum");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"one","1"},{"two","2"},{"three","3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		//-- give exact query and make sure that the statment cache doesn't
1:3d7c3d5: 		//-- mess up things.
1:3d7c3d5: 		ps.setString(1, "four");
1:3d7c3d5: 		ps.execute();
1:3d7c3d5: 		ps.setString(1, "four");
1:3d7c3d5: 		ps.execute();
1:0ee1994: 		rs=s.executeQuery("select * from testme order by autonum");
1:3d7c3d5: 		expectedRows=new String[][]{{"one","1"},{"two","2"},{"three","3"},{"four","4"},{"four","5"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("drop table testme");
1:fe9e3d4: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testnegativeinvalidtype() throws Exception
1:fe9e3d4: 	{
1:3d7c3d5: 		//-- negative tests from autoincrementNegative.sql
1:3d7c3d5: 		//-- negative bind tests.
1:3d7c3d5: 		//-- invalid types
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement pst=createStatement();
1:3d7c3d5: 		Statement s=createStatement(); 
1:fe9e3d4: 		
1:3d7c3d5: 		assertStatementError("42Z22",  pst,"create table ni (x int, y char(1) generated always as identity)");
1:3d7c3d5: 		assertStatementError("42Z22", pst,"create table ni (x int, y decimal(5,2) generated always as identity)");
1:3d7c3d5: 		assertStatementError("42Z22", pst,"create table ni (x int, y float generated always as identity (start with 1, increment by 1))");
1:3d7c3d5: 		assertStatementError("42Z22", pst,"create table ni (s int, y varchar(10) generated always as identity)");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (start with 0, increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y smallint generated always as identity (increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y smallint generated always as identity (start with 0, increment by 0))");
1:3d7c3d5: 		assertStatementError("42X01", pst,"create table ni (x int, y int generated always as identity (increment by 0)");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (start with 0, increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (start with 0, increment by 0))");
1:3d7c3d5: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (start with 0, increment by 0))");
1:3d7c3d5: 		assertStatementError("22003", pst,"create table ni (x int, y smallint generated always as identity (start with 32768))");
1:3d7c3d5: 		assertStatementError("22003", pst,"create table ni (x int, y smallint generated always as identity (start with -32769))");
1:3d7c3d5: 		assertStatementError("22003", pst,"create table ni (x int, y int generated always as identity (start with  2147483648))");
1:3d7c3d5: 		assertStatementError("22003", pst,"create table ni (x int, y int generated always as identity (start with  -2147483649))");
1:3d7c3d5: 		assertStatementError("42X49", pst,"create table ni (x int, y int generated always as identity (start with  9223372036854775808))");
1:3d7c3d5: 		assertStatementError("42X49", pst,"create table ni (x int, y bigint  generated always as identity (start with  -9223372036854775809))");
1:3d7c3d5: 		s.executeUpdate("insert into ai_neg (y) values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)");
1:0ee1994: 		rs=s.executeQuery("select * from ai_neg order by x");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"5","4"},{"6","5"},{"7","6"},{"8","7"},{"9","8"},{"10","9"},{"11","10"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("delete from ai_neg where y=8 OR y=4");
1:3d7c3d5: 		s.executeUpdate("insert into ai_neg (y) values (11),(13),(14),(15),(17),(18),(19)");
1:0ee1994: 		rs=s.executeQuery("select * from ai_neg order by x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("update ai_neg set y=-y");
1:3d7c3d5: 		rs=s.executeQuery("select * from ai_neg order by x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","-1"},{"3","-2"},{"4","-3"},{"6","-5"},{"7","-6"},{"8","-7"},{"10","-9"},{"11","-10"},{"12","-11"},{"13","-13"},{"14","-14"},{"15","-15"},{"16","-17"},{"17","-18"},{"18","-19"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("update ai_neg set y=-y");
1:3d7c3d5: 		rs=s.executeQuery("select * from ai_neg order by x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);		
1:3d7c3d5: 		s.executeUpdate("update ai_neg set y=4 where y=3"); // doubt WARNING 02000
1:3d7c3d5: 		rs=s.executeQuery("select * from ai_neg order by x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","4"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into ai_neg values (1,2)");
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public  void testOverflow()throws Exception
17:3d7c3d5: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement pst=createStatement();
1:3d7c3d5: 		Statement s=createStatement();
1:a180287: 		assertStatementError("2200H", pst,"insert into ai_over1 (x) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)");
1:a180287: 		assertStatementError("2200H", pst,"insert into ai_over1 (x) values (1)");		
1:3d7c3d5: 		s.executeUpdate("insert into ai_over2 (x) values (1),(2),(3),(4),(5),(6),(7),(8)");
1:a180287: 		assertStatementError("2200H", pst,"insert into ai_over2 (x) values (9),(10)");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","-32760"},{"2","-32761"},{"3","-32762"},{"4","-32763"},{"5","-32764"},{"6","-32765"},{"7","-32766"},{"8","-32767"}};
1:0ee1994: 		rs=s.executeQuery("select * from ai_over2 order by x");
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);		
1:3d7c3d5: 		s.executeUpdate("insert into ai_over3 (x) values (1)");
1:3d7c3d5: 		s.executeUpdate("insert into ai_over3 (x) values (2)");
1:0ee1994: 		rs=s.executeQuery("select * from ai_over3 order by x");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","2147483646"},{"2","2147483647"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287: 		assertStatementError("2200H", pst,"insert into ai_over3 (x) select x from ai_over3");			
1:3d7c3d5: 		//bigint overflow check		
1:a180287: 		s.executeUpdate("insert into ai_over4 (x) values (1),(2),(3)");
1:a180287: 		assertStatementError("2200H", pst,"insert into ai_over4 (x) values (4)");
1:0ee1994: 		rs=s.executeQuery("select * from ai_over4 order by x");
1:a180287: 		expectedRows=new String[][]
1:a180287:             {
1:a180287:                 {"1","9223372036854775805"},
1:a180287:                 {"2","9223372036854775806"},
1:a180287:                 {"3","9223372036854775807"},
1:a180287:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testIdentity()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		//-- IDENTITY_VAL_LOCAL function, same as DB2, beetle 5354
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement pst=createStatement();
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		pst.executeUpdate("insert into base values (1),(2),(3),(4),(5),(6)");
1:b5392db: 
1:b5392db:         String[][] expectedRows = {
1:b5392db:             {"1", "10"},
1:b5392db:             {"2", "11"},
1:b5392db:             {"3", "12"},
1:b5392db:             {"4", "13"},
1:b5392db:             {"5", "14"},
1:b5392db:             {"6", "15"},
6:fe9e3d4:         };
1:b5392db: 
1:b5392db:         assertUpdateCount(pst, 0, "alter table base add column y "
1:b5392db:                 + "smallint generated always as identity (start with 10)");
1:b5392db:         JDBC.assertFullResultSet(
1:b5392db:                 pst.executeQuery("select * from base order by x"),
1:b5392db:                 expectedRows);
1:b5392db:         assertUpdateCount(pst, 0, "alter table base drop column y");
1:b5392db: 
1:b5392db:         assertUpdateCount(pst, 0, "alter table base add column y "
1:b5392db:                 + "int generated always as identity (start with 10)");
1:b5392db:         JDBC.assertFullResultSet(
1:b5392db:                 pst.executeQuery("select * from base order by x"),
1:b5392db:                 expectedRows);
1:b5392db:         assertUpdateCount(pst, 0, "alter table base drop column y");
1:b5392db: 
1:b5392db:         assertUpdateCount(pst, 0, "alter table base add column y "
1:b5392db:                 + "bigint generated always as identity (start with 10)");
1:b5392db:         JDBC.assertFullResultSet(
1:b5392db:                 pst.executeQuery("select * from base order by x"),
1:b5392db:                 expectedRows);
1:b5392db:         assertUpdateCount(pst, 0, "alter table base drop column y");
1:b5392db: 
1:b5392db:         assertUpdateCount(pst, 0, "alter table base add column y "
1:b5392db:                 + "bigint generated always as identity (start with 10)");
1:b5392db:         JDBC.assertFullResultSet(
1:b5392db:                 pst.executeQuery("select * from base order by x"),
1:b5392db:                 expectedRows);
1:b5392db:         assertUpdateCount(pst, 0, "alter table base drop column y");
1:b5392db: 
1:0ee1994: 		rs=pst.executeQuery("select * from base order by x");
1:b5392db:         expectedRows = new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) values (8)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select IDENTITY_VAL_LOCAL()+1, IDENTITY_VAL_LOCAL()-1 from idt1");
1:3d7c3d5: 		expectedRows=new String[][]{{"2","0"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) values (IDENTITY_VAL_LOCAL())");
1:0ee1994: 		rs=s.executeQuery("select * from idt1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","8"},{"2","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select IDENTITY_VAL_LOCAL()+1, IDENTITY_VAL_LOCAL()-1 from idt1");
1:3d7c3d5: 		expectedRows=new String[][]{{"3","1"},{"3","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) values (8), (9)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:0ee1994: 		rs=s.executeQuery("select * from idt1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","8"},{"2","1"},{"3","8"},{"4","9"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) select c1 from idt1");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:0ee1994: 		rs=s.executeQuery("select * from idt1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","8"},{"2","1"},{"3","8"},{"4","9"},{"5","1"},{"6","2"},{"7","3"},{"8","4"}};
1:b5392db:         JDBC.assertFullResultSet(rs, expectedRows);
1:3d7c3d5: 		s.executeUpdate("delete from idt1");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) select c1 from idt1");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into idt1(c2) values (8)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"9"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testdefaultautoincrement() throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		//-- test cases for beetle 5404: inserting multiple rows of defaults into autoincrement column.
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		Statement pst=createStatement();
1:3d7c3d5: 		s.executeUpdate("insert into autoinct1 values (default)");
4:3d7c3d5: 		rs=s.executeQuery("select * from autoinct1");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);		
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (1), (1)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (1), (default)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (1)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (default), (2)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (2)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (2), (default)");
1:3d7c3d5: 		s.executeUpdate("insert into autoinct1 values (default), (default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"2"},{"3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into autoinct1 values (default), (default), (default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into autoinct1 values (default), (default), (default),(default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"},{"7"},{"8"},{"9"},{"10"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 		s.executeUpdate("insert into autoinct2 values (1, default), (2, default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct2 order by a");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"2","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct2 values (1, default), (2, 2)");
1:3d7c3d5: 		assertStatementError("42Z23", pst,"insert into autoinct2 values (1, default), (2, default), (2, 2)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct2 values (1, 2), (2, default), (2, default)");
1:3d7c3d5: 
1:3d7c3d5: 		s.executeUpdate("insert into autoinct3 values (default)");
5:3d7c3d5: 		rs=s.executeQuery("select * from autoinct3");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into autoinct3 values (default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"4"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (1), (default)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (1)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (default), (2)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (2)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (2), (default)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into autoinct3 select * from autoinct1");
1:3d7c3d5: 		s.executeUpdate("insert into autoinct3 values (default), (default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into autoinct3 values (default), (default), (default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"},{"13"},{"16"},{"19"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("insert into autoinct3 values (default), (default), (default),(default)");
1:0ee1994: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1:3d7c3d5: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"},{"13"},{"16"},{"19"},{"22"},{"25"},{"28"},{"31"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.executeUpdate("drop table autoinct1");
1:3d7c3d5: 		s.executeUpdate("drop table autoinct2");
1:3d7c3d5: 		s.executeUpdate("drop table autoinct3");
1:3d7c3d5: 
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testwithIncrement()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		Statement pst=createStatement();
1:3d7c3d5: 		s.execute("insert into withinct1(i) values(1)");
1:3d7c3d5: 		s.execute("insert into withinct1(i) values(1)");
1:0ee1994: 		rs=s.executeQuery("select * from withinct1 order by withinct1_autogen");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","1"},{"1","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into withinct2(i) values(1)");
1:3d7c3d5: 		s.execute("insert into withinct2(i) values(1)");
1:0ee1994: 		rs=s.executeQuery("select * from withinct2 order by withinct2_autogen");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"1","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into withinctempt1(i,withinct1_autogen) values(2,1)");
1:3d7c3d5: 		assertStatementError("42Z23",pst,"insert into withinctempt1(i,withinct1_autogen) values(2,2)");		
1:3d7c3d5: 		s.execute("insert into withinctempt1(i) values(2)");
1:3d7c3d5: 		s.execute("insert into withinctempt1(i) values(2)");
1:0ee1994: 		rs=s.executeQuery("select * from withinctempt1 order by withinct1_autogen");
1:3d7c3d5: 		expectedRows=new String[][]{{"2","1"},{"2","2"}};		
1:3d7c3d5: 		//Utilities.showResultSet(rs);
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into withinctempt2(i,withinct2_autogen) values(2,1)");
1:3d7c3d5: 		s.execute("insert into withinctempt2(i,withinct2_autogen) values(2,2)");		
1:3d7c3d5: 		s.execute("insert into withinctempt2(i) values(2)");
1:3d7c3d5: 		s.execute("insert into withinctempt2(i) values(2)");
1:0ee1994: 		rs=s.executeQuery("select * from withinctempt2 order by withinct2_autogen, i");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"2","1"},
1:0ee1994:                 {"2","1"},
1:0ee1994:                 {"2","2"},
1:0ee1994:                 {"2","2"}
1:0ee1994:             };		
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);		
1:3d7c3d5: 		s.execute("insert into withinctempt3(i) values(1)");
1:3d7c3d5: 		s.execute("insert into withinctempt3(i) values(1)");			
1:0ee1994: 		rs=s.executeQuery("select * from withinctempt3 order by t1_autogen");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"1","11"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into withinctempt4(i) values(1)");
1:3d7c3d5: 		s.execute("insert into withinctempt4(i) values(1)");			
1:0ee1994: 		rs=s.executeQuery("select * from withinctempt4 order by t2_autogen");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"1","11"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("42Z23",s,"insert into withinct3(i,withinct3_autogen) values(2,1)");
1:3d7c3d5: 		assertStatementError("42Z23",s,"insert into withinct3(i,withinct3_autogen) values(2,2)");
1:3d7c3d5: 		s.execute("insert into withinct3(i) values(2)");			
1:3d7c3d5: 		s.execute("insert into withinct3(i) values(2)");
1:0ee1994: 		rs=s.executeQuery("select * from withinct3 order by withinct3_autogen");
1:3d7c3d5: 		expectedRows=new String[][]{{"2","1"},{"2","11"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into withinct4(i,withinct4_autogen) values(2,1)");
1:3d7c3d5: 		s.execute("insert into withinct4(i,withinct4_autogen) values(2,2)");
1:3d7c3d5: 		s.execute("insert into withinct4(i) values(2)");
1:3d7c3d5: 		s.execute("insert into withinct4(i) values(2)");
1:0ee1994: 		rs=s.executeQuery("select * from withinct4 order by withinct4_autogen");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"2","1"},
1:0ee1994:                 {"2","1"},
1:0ee1994:                 {"2","2"},
1:0ee1994:                 {"2","11"},
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testunique()throws Exception
1:3d7c3d5: 	{	//--with unique constraint
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.execute("insert into uniquet1(i) values(1)");
1:3d7c3d5: 		s.execute("insert into uniquet1(i) values(1)");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","100"},{"1","120"}};
1:0ee1994: 		rs=s.executeQuery("select * from uniquet1 order by t1_autogen");
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into uniquet2(i) values(1)");
1:3d7c3d5: 		s.execute("insert into uniquet2(i) values(1)");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","100"},{"1","120"}};
1:0ee1994: 		rs=s.executeQuery("select * from uniquet2 order by t2_autogen");
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		
1:3d7c3d5: 		assertStatementError("42Z23",s,"insert into uniquetempt1(i,t1_autogen) values(2,1)");
1:3d7c3d5: 		assertStatementError("42Z23",s,"insert into uniquetempt1(i,t1_autogen) values(2,2)");
1:3d7c3d5: 		s.execute("insert into uniquetempt1(i) values(2)");
1:3d7c3d5: 		s.execute("insert into uniquetempt1(i) values(2)");
1:3d7c3d5: 		expectedRows=new String[][]{{"2","100"},{"2","120"}};
1:0ee1994: 		rs=s.executeQuery("select * from uniquetempt1 order by t1_autogen");
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		
1:3d7c3d5: 		s.execute("insert into uniquetempt2(i,t2_autogen) values(2,1)");
1:3d7c3d5: 		s.execute("insert into uniquetempt2(i,t2_autogen) values(2,2)");
1:3d7c3d5: 		s.execute("insert into uniquetempt2(i) values(2)");
1:3d7c3d5: 		s.execute("insert into uniquetempt2(i) values(2)");
1:3d7c3d5: 		expectedRows=new String[][]{{"2","1"},{"2","2"},{"2","100"},{"2","120"}};
1:3d7c3d5: 		
1:3d7c3d5: 		//assertStatementError("23505",pst,"insert into uniquet3(i,uniquet3_autogen) values(1,0)");
1:3d7c3d5: 		s.execute("insert into uniquet3(i,uniquet3_autogen) values(1,0)");
1:3d7c3d5: 		//assertStatementError("23505",pst,"insert into uniquet3(i,uniquet3_autogen) values(2,1)");
1:3d7c3d5: 		s.execute("insert into uniquet3(i,uniquet3_autogen) values(2,1)");
1:3d7c3d5: 		assertStatementError("23505",s,"insert into uniquet3(i) values(3)");
1:3d7c3d5: 		assertStatementError("23505",s,"insert into uniquet3(i) values(4)");
1:3d7c3d5: 		s.execute("insert into uniquet3(i) values(5)");		
1:0ee1994: 		rs=s.executeQuery("select i,uniquet3_autogen from uniquet3 order by i");
1:3d7c3d5: 		//Utilities.showResultSet(rs);
1:3d7c3d5: 
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"5","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 
1:3d7c3d5: 		//--with unique index
1:3d7c3d5: 		s.execute("insert into uniquet4(i,uniquet4_autogen) values(1,0)");
1:3d7c3d5: 		s.execute("insert into uniquet4(i,uniquet4_autogen) values(2,1)");
1:3d7c3d5: 		assertStatementError("23505",s,"insert into uniquet4(i) values(3)");
1:3d7c3d5: 		assertStatementError("23505",s,"insert into uniquet4(i) values(4)");
1:3d7c3d5: 		s.execute("insert into uniquet4(i) values(5)");
1:0ee1994: 		rs=s.executeQuery("select i,uniquet4_autogen from uniquet4 order by i");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"5","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testidvalconn()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		//-- test IDENTITY_VAL_LOCAL function with 2 different connections
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Connection conn1=openUserConnection("conn1");
1:3d7c3d5: 		Statement conn1st=conn1.createStatement();
1:3d7c3d5: 		conn1st.execute("create table idvalt1 (c11 int generated always as identity (start with 101, increment by 3), c12 int)");
1:3d7c3d5: 		conn1st.execute("create table idvalt2 (c21 int generated always as identity (start with 201, increment by 5), c22 int)");
1:3d7c3d5: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{null}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn1.commit();
1:3d7c3d5: 		Connection conn2=openUserConnection("conn2");
1:3d7c3d5: 		Statement conn2st=conn2.createStatement();
1:3d7c3d5: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{null}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		//conn2st.executeUpdate("insert into idvalt2 (c22) values (1)");
1:3d7c3d5: 		conn2st.execute("insert into conn1.idvalt2 (c22) values (1)");
1:3d7c3d5: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"201"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn1=openUserConnection("conn1");
1:3d7c3d5: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{null}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn1st.execute("insert into idvalt1 (c12) values (1)");
1:3d7c3d5: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");		
1:3d7c3d5: 		expectedRows=new String[][]{{"101"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn2st=conn2.createStatement();
1:3d7c3d5: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"201"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn2.commit();
1:3d7c3d5: 		conn2st=conn2.createStatement();
1:3d7c3d5: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		expectedRows=new String[][]{{"201"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		conn1st.execute("drop table idvalt1");
1:3d7c3d5: 		conn1st.execute("drop table idvalt2");
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testidvalVariants()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		/*-- A table with identity column has an insert trigger which inserts into another table 
1:3d7c3d5: 		-- with identity column. IDENTITY_VAL_LOCAL will return the generated value for the 
1:3d7c3d5: 		-- statement table and not for the table that got modified by the trigger*/
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.execute("insert into variantt1 (c12) values (1)");
1:3d7c3d5: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"101"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select * from variantt1");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"101","1"}
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select * from variantt2");
1:3d7c3d5: 		expectedRows=new String[][]{{"201","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testrestart()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		//-- Test RESTART WITH syntax of ALTER TABLE for autoincrment columns
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
2:3d7c3d5: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'REC11'");
1:3d7c3d5: 
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"REC11","2","2","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into restartt1 values(2,2)");
2:3d7c3d5: 		rs=s.executeQuery("select * from restartt1");
1:3d7c3d5: 
1:3d7c3d5: 		expectedRows=new String[][]{{"2","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'REC11'");
1:3d7c3d5: 		expectedRows=new String[][]{{"REC11","2","2","2"}};									  
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into restartt1(c12) values(9999)");
1:0ee1994: 		rs=s.executeQuery("select * from restartt1 order by c12");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"2","2"},
1:0ee1994:                 {"2","9999"}
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287:         vetSequenceState( "RESTARTT1", 4, 2, 2 );
1:3d7c3d5: 		assertStatementError("42837",s,"alter table restartt1 alter column c12 RESTART WITH 2");
1:3d7c3d5: 		assertStatementError("42X49",s,"alter table restartt1 alter column rec11 RESTART WITH 2.20");
1:3d7c3d5: 		s.execute("alter table restartt1 alter column rec11 RESTART WITH 2");
1:3d7c3d5: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC	from sys.syscolumns where COLUMNNAME = 'REC11'");
1:3d7c3d5: 		expectedRows=new String[][]{{"REC11","2","2","2"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testlock()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		/*--following puts locks on system table SYSCOLUMNS's row for t1lock.c11
1:3d7c3d5: 		--Later when a user tries to have the system generate a value for the
1:3d7c3d5: 		--t1lock.c11, system can't generate that value in a transaction of it's own
1:3d7c3d5: 		--and hence it reverts to the user transaction to generate the next value.
1:3d7c3d5: 		--This use of user transaction to generate a value can be problematic if
1:3d7c3d5: 		--user statement to generate the next value runs into statement rollback.
1:3d7c3d5: 		--This statement rollback will cause the next value generation to rollback
1:3d7c3d5: 		--too and system will not be able to consume the generated value. 
1:3d7c3d5: 		--In a case like this, user can use ALTER TABLE....RESTART WITH to change the
1:3d7c3d5: 		--start value of the autoincrement column as shown below.*/
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 
1:3d7c3d5: 		s.execute("insert into t1lock values(1,1)");
1:3d7c3d5: 		rs=s.executeQuery("select * from t1lock");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
2:3d7c3d5: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'LOCKC11'");
1:3d7c3d5: 		expectedRows=new String[][]{{"LOCKC11","1","1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		assertStatementError("23505",s,"insert into t1lock(c12) values(3)");
1:a180287:         vetSequenceState( "T1LOCK", 2, 1, 1 );
1:3d7c3d5: 
1:3d7c3d5: 		rs=s.executeQuery("select * from t1lock");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("alter table t1lock alter column lockc11 restart with 2");
1:3d7c3d5: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'LOCKC11'");
1:3d7c3d5: 		expectedRows=new String[][]{{"LOCKC11","2","2","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into t1lock(c12) values(3)");
1:3d7c3d5: 		rs=s.executeQuery("select * from t1lock");
1:3d7c3d5: 		expectedRows=new String[][]{{"1","1"},{"2","3"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 	}
1:3d7c3d5: 	public void test_Derby14951465() throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();		
1:3d7c3d5: 		rs=s.executeQuery("SELECT	col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1495' AND ColumnName = 'TESTID'");
1:3d7c3d5: 		String[][]expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","1","1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("INSERT INTO DERBY_1495(TESTID, TESTCOL2) VALUES(2, 2)");
1:3d7c3d5: 		s.execute("ALTER TABLE DERBY_1495 ALTER COLUMN TESTid RESTART WITH 3");
1:3d7c3d5: 		rs=s.executeQuery("SELECT	col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1495' AND ColumnName = 'TESTID'");
1:3d7c3d5: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","3","3","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 		/*-- Similarly, verify that if we change the INCREMENT BY value for a
1:3d7c3d5: 		-- GENERATED_BY_DEFAULT column, the column remains GENERATED_BY_DEFAULT
1:3d7c3d5: 		-- and its START WITH value is preserved.*/
1:3d7c3d5: 
1:3d7c3d5: 		rs=s.executeQuery("SELECT col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1645' AND ColumnName = 'TESTTABLEID'");
1:3d7c3d5: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","1","1","1"}};
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:a180287: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-1, 'test1')");
1:a180287: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-2, 'test2')");
1:a180287: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-3, 'test3')");
1:3d7c3d5: 		s.execute("ALTER TABLE derby_1645 ALTER TESTTableId SET INCREMENT BY 50");
1:3d7c3d5: 		rs=s.executeQuery("SELECT col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1645' AND ColumnName = 'TESTTABLEID'");
1:3d7c3d5: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","53","1","50"}};
1:3d7c3d5: 		s.execute("INSERT INTO derby_1645 (TESTStringValue) VALUES ('test53')");
1:3d7c3d5: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TEST" +"StringValue) VALUES (-999, 'test3')");
1:3d7c3d5: 		s.execute("drop table derby_1645");
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void TESTD1644()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		/*-- Test cases related to DERBY-1644, which involve:
1:3d7c3d5: 		--  a) multi-row VALUES clauses
1:3d7c3d5: 		--  b) GENERATED BY DEFAULT autoincrement fields
1:3d7c3d5: 		--  c) insert statements which mention only a subset of the table's columns
1:3d7c3d5: 		-- First we have the actual case from the bug report. Then we have a number
1:3d7c3d5: 		-- of other similar cases, to try to cover the code area in question*/
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values default, 10");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values (11)");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values default");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values (default)");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values 12, 13, 14");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values 15, 16, default");
1:3d7c3d5: 		s.execute("insert into D1644 values (17, 18)");
1:3d7c3d5: 		s.execute("insert into D1644 values (19, default)");
1:3d7c3d5: 		s.execute("insert into D1644 values (20, default), (21, 22), (23, 24), (25, default)");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (default, 26)");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (27, 28), (default, 29), (30, 31)");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2) values default, default, default, default");
1:3d7c3d5: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (default, 128),(default, 129),(default, 131)");
1:0ee1994: 		rs=s.executeQuery("select * from D1644 order by d1644c1, d1644c2");
1:0ee1994: 		String[][]expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"17","18"},
1:0ee1994:                 {"19","5"},
1:0ee1994:                 {"20","6"},
1:0ee1994:                 {"21","22"},
1:0ee1994:                 {"23","24"},
1:0ee1994:                 {"25","7"},
1:0ee1994:                 {"26","8"},
1:0ee1994:                 {"28","27"},
1:0ee1994:                 {"29","9"},
1:0ee1994:                 {"31","30"},
1:0ee1994:                 {"128","14"},
1:0ee1994:                 {"129","15"},
1:0ee1994:                 {"131","16"},
1:0ee1994:                 {null,"1"},
1:0ee1994:                 {null,"2"},
1:0ee1994:                 {null,"3"},
1:0ee1994:                 {null,"4"},
1:0ee1994:                 {null,"10"},
1:0ee1994:                 {null,"10"},
1:0ee1994:                 {null,"11"},
1:0ee1994:                 {null,"11"},
1:0ee1994:                 {null,"12"},
1:0ee1994:                 {null,"12"},
1:0ee1994:                 {null,"13"},
1:0ee1994:                 {null,"13"},
1:0ee1994:                 {null,"14"},
1:0ee1994:                 {null,"15"},
1:0ee1994:                 {null,"16"},
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into D1644_A (c3, d1644_Ac1, d1644_Ac2) values (1, 2, default)");
1:3d7c3d5: 		s.execute("insert into D1644_A (c3, d1644_Ac1, d1644_Ac2) values (3,4,5), (6,7,default)");
1:3d7c3d5: 		s.execute("insert into D1644_A (c3, d1644_Ac2) values (8, default), (9, 10)");
1:0ee1994: 		rs=s.executeQuery("select * from D1644_A order by d1644_Ac1, d1644_Ac2");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"2","1","1"},
1:0ee1994:                 {"4","5","3"},
1:0ee1994:                 {"7","2","6"},
1:0ee1994:                 {null,"3","8"},
1:0ee1994:                 {null,"10","9"}
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("insert into D1644_B (d1644_Bc1) values default, 10");
1:3d7c3d5: 		s.execute("insert into D1644_B values default, 10");
1:0ee1994: 		rs=s.executeQuery("select * from D1644_B order by d1644_Bc1");
1:0ee1994: 		expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"1"},
1:0ee1994:                 {"2"},
1:0ee1994:                 {"10"},
1:0ee1994:                 {"10"}
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 
1:3d7c3d5: 
1:3d7c3d5: 	}
1:3d7c3d5: 	public void testDerby2902()throws Exception
1:3d7c3d5: 	{
1:3d7c3d5: 		/*-- Derby-2902: can't use LONG.MIN_VALUE as the start value for
1:3d7c3d5: 		-- an identity column. These tests verify that values less than MIN_VALUE
1:3d7c3d5: 		-- or greater than MAX_VALUE are rejected, but MIN_VALUE and MAX_VALUE
1:3d7c3d5: 		-- themeselves are accepted.*/
1:3d7c3d5: 		ResultSet rs;
1:3d7c3d5: 		Statement s=createStatement();
1:3d7c3d5: 		s.execute("insert into d4006 values default");
1:3d7c3d5: 		s.execute("alter table d4006 alter column x with default null");
1:3d7c3d5: 		s.execute("insert into d4006 values default");
1:3d7c3d5: 		s.execute("alter table d4006 alter column x with default 'def'");
1:3d7c3d5: 		s.execute("insert into d4006 values default");
1:0ee1994: 		rs=s.executeQuery("select * from d4006 order by x");
1:0ee1994: 		String[][]expectedRows=new String[][]
1:0ee1994:             {
1:0ee1994:                 {"abc"},
1:0ee1994:                 {"def"},
1:0ee1994:                 {null},
1:0ee1994:             };
1:3d7c3d5: 		JDBC.assertFullResultSet(rs,expectedRows);
1:3d7c3d5: 		s.execute("alter table d4006 add column y int generated always as (-1)");
1:3d7c3d5: 		assertStatementError("42XA7",s,"alter table d4006 alter column y default 42");
1:3d7c3d5: 		assertStatementError("42XA7",s,"alter table d4006 alter column y default null");
1:fe9e3d4: 
1:6fdf9c0: 		assertStatementError( "42XA7", s, "alter table d4006_a alter column z default 99" );
1:6fdf9c0: 		assertStatementError( "42XA7", s, "alter table d4006_a alter column z default null" );
1:fe9e3d4: 	}
1:3d7c3d5: 	
1:bb4cfe9: 	public static Test suite() {
1:bb4cfe9: 		return new CleanDatabaseTestSetup(
1:1ae02c9:             new BaseTestSuite(AutoIncrementTest.class, "AutoIncrementTest")) {
1:3d7c3d5: 			protected void decorateSQL(Statement s)
1:3d7c3d5: 			throws SQLException
1:3d7c3d5: 			{
1:3d7c3d5: 				createSchemaObjects(s);
1:3d7c3d5: 			}
1:fe9e3d4: 		};
1:3d7c3d5: 	}
1:3d7c3d5: }
============================================================================
author:Richard N. Hillegas
-------------------------------------------------------------------------------
commit:39b3237
/////////////////////////////////////////////////////////////////////////
1: 		Integer i= 1;
/////////////////////////////////////////////////////////////////////////
1: 			i= j;
commit:a180287
/////////////////////////////////////////////////////////////////////////
1:         vetSequenceState( "ai_short", 8, 0, 2 );
1:     private void    vetSequenceState( String tableName, long currentValue, long startValue, long stepValue )
1:         throws Exception
1:     {
1:         Connection  conn = getConnection();
1:         String  sequenceName = IdentitySequenceTest.getIdentitySequenceName( conn, tableName );
1:         ResultSet   rs = conn.prepareStatement
1:             (
1:              "select s.startValue, s.increment\n" +
1:              "from sys.syssequences s\n" +
1:              "where sequenceName = '" + sequenceName + "'"
1:              ).executeQuery();
1:         String[][]  expectedRows = new String[][]
1:         {
1:             { Long.toString( startValue ), Long.toString( stepValue ) }
1:         };
1:         JDBC.assertFullResultSet( rs,expectedRows );
1: 
1:         rs = conn.prepareStatement
1:             (
1:              "values syscs_util.syscs_peek_at_identity( 'APP', '" + tableName.toUpperCase() + "' )"
1:              ).executeQuery();
1:         expectedRows = new String[][] { { Long.toString( currentValue ) } };
1:         JDBC.assertFullResultSet( rs,expectedRows );
1:     }
/////////////////////////////////////////////////////////////////////////
1:         vetSequenceState( "TAB1", 4, 1, 1 );
1:         vetSequenceState( "TAB2", 4, 1, 1 );
/////////////////////////////////////////////////////////////////////////
1: 		expectedRows=new String[][]
1:             {
1:                 {"APP     ","UserTran","TABLE   ","1   ","S   ","SYSCOLUMNS  ","GRANT","ACTIVE"}
1:             };
1: 		expectedRows=new String[][]
1:             {
1:                 {"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"}
1:             };
1: 		expectedRows=new String[][]
1:             {
1:                 {"APP     ","UserTran","TABLE   ","1  ","IX","LOCKT1      ","GRANT","ACTIVE"},
1:                 {"APP     ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:                 {"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"},
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		assertStatementError("2200H", pst,"insert into ai_over1 (x) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)");
1: 		assertStatementError("2200H", pst,"insert into ai_over1 (x) values (1)");		
1: 		assertStatementError("2200H", pst,"insert into ai_over2 (x) values (9),(10)");
/////////////////////////////////////////////////////////////////////////
1: 		assertStatementError("2200H", pst,"insert into ai_over3 (x) select x from ai_over3");			
1: 		s.executeUpdate("insert into ai_over4 (x) values (1),(2),(3)");
1: 		assertStatementError("2200H", pst,"insert into ai_over4 (x) values (4)");
1: 		expectedRows=new String[][]
1:             {
1:                 {"1","9223372036854775805"},
1:                 {"2","9223372036854775806"},
1:                 {"3","9223372036854775807"},
1:             };
/////////////////////////////////////////////////////////////////////////
1:         vetSequenceState( "RESTARTT1", 4, 2, 2 );
/////////////////////////////////////////////////////////////////////////
1:         vetSequenceState( "T1LOCK", 2, 1, 1 );
/////////////////////////////////////////////////////////////////////////
1: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-1, 'test1')");
1: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-2, 'test2')");
1: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (-3, 'test3')");
commit:6fdf9c0
/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////
1: 		assertStatementError( "42XA7", s, "alter table d4006_a alter column z default 99" );
1: 		assertStatementError( "42XA7", s, "alter table d4006_a alter column z default null" );
commit:0ee1994
/////////////////////////////////////////////////////////////////////////
1: 		rs = s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME in ('A_ZERO','A_ONE', 'A_TWO', 'A_THREE') order by COLUMNNAME");
1: 		String [][]expectedRows=
1:             {
1: 				{"A_ONE","1","1","1"},
1:                 {"A_THREE","1","1","1"},
1:                 {"A_TWO","1","1","1"},
1:                 {"A_ZERO","1","1","1"},
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs = s.executeQuery("select * from ai_short order by i");
/////////////////////////////////////////////////////////////////////////
1: 		rs = s.executeQuery("select a.i, a0, a1, a2, a3 from ai_single1 a join ai_single2 b on a.i = b.i join ai_single3 c on a.i = c.i join ai_single4 d on a.i = d.i order by a.i");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select a.i, a1, a2 from tab1schema a join tab2schema b on a.i = b.i order by a.i");
1: 		rs=s.executeQuery("select a1, a2, a.i from tab3schema a join tab4schema b on a.i = b.i order by a1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from tab1 order by s1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from tab2 order by lvl");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from trigtest order by s1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2  a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
1: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x order by a.x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from lockt1 order by x");
1: 		rs=s.executeQuery("select * from lock_table order by username, trantype, type, cnt");
1: 		expectedRows=new String[][]
1:             {
1:                 {"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:                 {"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},
1:                 {"APP   ","UserTran","TABLE   ","2  ","IX","LOCKT1      ","GRANT","ACTIVE"},
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from t1_col order by y");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from testme order by autonum");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from testme order by autonum");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from ai_neg order by x");
1: 		rs=s.executeQuery("select * from ai_neg order by x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from ai_over2 order by x");
1: 		rs=s.executeQuery("select * from ai_over3 order by x");
1: 		rs=s.executeQuery("select * from ai_over4 order by x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=pst.executeQuery("select * from base order by x");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from idt1 order by c1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from idt1 order by c1");
1: 		rs=s.executeQuery("select * from idt1 order by c1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1: 		rs=s.executeQuery("select * from autoinct1 order by c1");
1: 		rs=s.executeQuery("select * from autoinct2 order by a");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from autoinct3 order by c1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1: 		rs=s.executeQuery("select * from autoinct3 order by c1");
1: 		rs=s.executeQuery("select * from autoinct3 order by c1");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from withinct1 order by withinct1_autogen");
1: 		rs=s.executeQuery("select * from withinct2 order by withinct2_autogen");
1: 		rs=s.executeQuery("select * from withinctempt1 order by withinct1_autogen");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from withinctempt2 order by withinct2_autogen, i");
1: 		expectedRows=new String[][]
1:             {
1:                 {"2","1"},
1:                 {"2","1"},
1:                 {"2","2"},
1:                 {"2","2"}
1:             };		
1: 		rs=s.executeQuery("select * from withinctempt3 order by t1_autogen");
1: 		rs=s.executeQuery("select * from withinctempt4 order by t2_autogen");
1: 		rs=s.executeQuery("select * from withinct3 order by withinct3_autogen");
1: 		rs=s.executeQuery("select * from withinct4 order by withinct4_autogen");
1: 		expectedRows=new String[][]
1:             {
1:                 {"2","1"},
1:                 {"2","1"},
1:                 {"2","2"},
1:                 {"2","11"},
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from uniquet1 order by t1_autogen");
1: 		rs=s.executeQuery("select * from uniquet2 order by t2_autogen");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from uniquetempt1 order by t1_autogen");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select i,uniquet3_autogen from uniquet3 order by i");
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select i,uniquet4_autogen from uniquet4 order by i");
/////////////////////////////////////////////////////////////////////////
1: 		expectedRows=new String[][]
1:             {
1:                 {"101","1"}
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from restartt1 order by c12");
1: 		expectedRows=new String[][]
1:             {
1:                 {"2","2"},
1:                 {"2","9999"}
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from D1644 order by d1644c1, d1644c2");
1: 		String[][]expectedRows=new String[][]
1:             {
1:                 {"17","18"},
1:                 {"19","5"},
1:                 {"20","6"},
1:                 {"21","22"},
1:                 {"23","24"},
1:                 {"25","7"},
1:                 {"26","8"},
1:                 {"28","27"},
1:                 {"29","9"},
1:                 {"31","30"},
1:                 {"128","14"},
1:                 {"129","15"},
1:                 {"131","16"},
1:                 {null,"1"},
1:                 {null,"2"},
1:                 {null,"3"},
1:                 {null,"4"},
1:                 {null,"10"},
1:                 {null,"10"},
1:                 {null,"11"},
1:                 {null,"11"},
1:                 {null,"12"},
1:                 {null,"12"},
1:                 {null,"13"},
1:                 {null,"13"},
1:                 {null,"14"},
1:                 {null,"15"},
1:                 {null,"16"},
1:             };
1: 		rs=s.executeQuery("select * from D1644_A order by d1644_Ac1, d1644_Ac2");
1: 		expectedRows=new String[][]
1:             {
1:                 {"2","1","1"},
1:                 {"4","5","3"},
1:                 {"7","2","6"},
1:                 {null,"3","8"},
1:                 {null,"10","9"}
1:             };
1: 		rs=s.executeQuery("select * from D1644_B order by d1644_Bc1");
1: 		expectedRows=new String[][]
1:             {
1:                 {"1"},
1:                 {"2"},
1:                 {"10"},
1:                 {"10"}
1:             };
/////////////////////////////////////////////////////////////////////////
1: 		rs=s.executeQuery("select * from d4006 order by x");
1: 		String[][]expectedRows=new String[][]
1:             {
1:                 {"abc"},
1:                 {"def"},
1:                 {null},
1:             };
commit:bb4cfe9
/////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"AIS","8","0","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"TAB1","4","1","1"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"APP     ","UserTran","TABLE   ","1  ","IX","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","TABLE   ","1  ","IX","SYSCOLUMNS  ","GRANT","ACTIVE"},{"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"},{"APP     ","UserTran","ROW     ","2  ","X","SYSCOLUMNS  ","GRANT","ACTIVE"}};
/////////////////////////////////////////////////////////////////////////
0: 		assertStatementError("22003", pst,"insert into ai_over1 (x) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)");
0: 		assertStatementError("22003", pst,"insert into ai_over1 (x) values (1)");		
0: 		assertStatementError("22003", pst,"insert into ai_over2 (x) values (9),(10)");
/////////////////////////////////////////////////////////////////////////
0: 		assertStatementError("22003", pst,"insert into ai_over3 (x) select x from ai_over3");			
0: 		s.executeUpdate("insert into ai_over4 (x) values (1),(2)");
0: 		assertStatementError("22003", pst,"insert into ai_over4 (x) values (3)");
0: 		expectedRows=new String[][]{{"1","9223372036854775805"},{"2","9223372036854775806"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"REC11","4","2","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"LOCKC11","2","1","1"}};
/////////////////////////////////////////////////////////////////////////
1: 	public static Test suite() {
1: 		return new CleanDatabaseTestSetup(
/////////////////////////////////////////////////////////////////////////
commit:365a750
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"AIS","40","0","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"TAB1","21","1","1"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"REC11","42","2","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"LOCKC11","21","1","1"}};
commit:fe9e3d4
/////////////////////////////////////////////////////////////////////////
0: import org.apache.derbyTesting.junit.SupportFilesSetup;
0:     private static  final   String  IMPORT_FILE_NAME = "t_4437_2.dat";
/////////////////////////////////////////////////////////////////////////
1: 
1:     /**
0:      * <p>
0:      * Test that alter table interacts well with the sequence-generator-based identity generators.
0:      * </p>
1:      */
0:     public  void    test_4437_01_alterTable()   throws Exception
1:     {
1: 		Statement s = createStatement();
0:         String[][] expectedResults;
1:         
0: 		s.execute("create table t_4437_1( a int, b int generated always as identity )");
0: 		s.execute("insert into t_4437_1( a ) values (100), (101), (102), (103), (104), (105)");
0:         expectedResults = new String[][]
1:         {
0:             { "100",        "1", },
0:             { "101",        "2", },
0:             { "102",        "3", },
0:             { "103",        "4", },
0:             { "104",        "5", },
0:             { "105",        "6", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_1 order by a" ), expectedResults );
1: 
0: 		s.execute("alter table t_4437_1 alter column b restart with 22");
0: 		s.execute("insert into t_4437_1( a ) values (110), (111), (112), (113), (114), (115)");
0:         expectedResults = addResults
0:             (
0:              expectedResults,
0:              new String[][]
1:              {
0:                  { "110",        "22", },
0:                  { "111",        "23", },
0:                  { "112",        "24", },
0:                  { "113",        "25", },
0:                  { "114",        "26", },
0:                  { "115",        "27", },
1:              }
0:              );
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_1 order by a" ), expectedResults );
1: 
0: 		s.execute("alter table t_4437_1 alter column b set increment by 3");
0: 		s.execute("insert into t_4437_1( a ) values (120), (121), (122), (123), (124)");
0:         expectedResults = addResults
0:             (
0:              expectedResults,
0:              new String[][]
1:              {
0:                  { "120",        "30", },
0:                  { "121",        "33", },
0:                  { "122",        "36", },
0:                  { "123",        "39", },
0:                  { "124",        "42", },
1:              }
0:              );
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_1 order by a" ), expectedResults );
1: 
0: 		s.execute("alter table t_4437_1 alter column b set increment by 4");
0: 		s.execute("insert into t_4437_1( a ) values (130), (131), (132), (133), (134), (135)");
0:         expectedResults = addResults
0:             (
0:              expectedResults,
0:              new String[][]
1:              {
0:                  { "130",        "46", },
0:                  { "131",        "50", },
0:                  { "132",        "54", },
0:                  { "133",        "58", },
0:                  { "134",        "62", },
0:                  { "135",        "66", },
1:              }
0:              );
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_1 order by a" ), expectedResults );
1: 
0:         s.execute( "drop table t_4437_1" );
1:     }
0:     private String[][]  addResults( String[][] original, String[][] extras )
1:     {
0:         int originalLength = original.length;
0:         int extrasLength = extras.length;
0:         String[][]  result = new String[ originalLength + extrasLength ][];
1: 
0:         int idx = 0;
0:         for ( int i = 0; i < originalLength; i++ ) { result[ idx++ ] = original[ i ]; }
0:         for ( int i = 0; i < extrasLength; i++ ) { result[ idx++ ] = extras[ i ]; }
1: 
0:         return result;
1:     }
1:     /**
0:      * <p>
0:      * Test that bulk import interacts well with the sequence-generator-based identity generators.
0:      * </p>
1:      */
0:     public  void    test_4437_02_bulkImport()   throws Exception
1:     {
1: 		Statement s = createStatement();
0:         String[][] expectedResults;
1: 
0: 		s.execute( "create table t_4437_2( a int, b int generated always as identity (start with -10, increment by -3) )" );
0: 		s.execute( "insert into t_4437_2( a ) values (110), (111), (112), (113), (114), (115)" );
0:         expectedResults = new String[][]
1:         {
0:             { "110",        "-10", },
0:             { "111",        "-13", },
0:             { "112",        "-16", },
0:             { "113",        "-19", },
0:             { "114",        "-22", },
0:             { "115",        "-25", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_2 order by a" ), expectedResults );
1: 
0:         // import running in replace mode resets the sequence counter
0: 		s.execute( "call syscs_util.syscs_import_data( null, 'T_4437_2', 'A', null, 'extin/" + IMPORT_FILE_NAME + "', null, null, null, 1 )" );
0:         expectedResults = new String[][]
1:         {
0:             { "100",        "-10", },
0:             { "101",        "-13", },
0:             { "102",        "-16", },
0:             { "103",        "-19", },
0:             { "104",        "-22", },
0:             { "105",        "-25", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_2 order by a" ), expectedResults );
1: 
0:         // truncate does not reset the counter
0: 		s.execute( "truncate table t_4437_2" );
0: 		s.execute( "insert into t_4437_2( a ) values (110), (111), (112), (113), (114), (115)" );
0:         expectedResults = new String[][]
1:         {
0:             { "110",        "-28", },
0:             { "111",        "-31", },
0:             { "112",        "-34", },
0:             { "113",        "-37", },
0:             { "114",        "-40", },
0:             { "115",        "-43", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_2 order by a" ), expectedResults );
1: 
0:         // delete does not reset the counter either
0: 		s.execute( "delete from t_4437_2" );
0: 		s.execute( "insert into t_4437_2( a ) values (110), (111), (112), (113), (114), (115)" );
0:         expectedResults = new String[][]
1:         {
0:             { "110",        "-46", },
0:             { "111",        "-49", },
0:             { "112",        "-52", },
0:             { "113",        "-55", },
0:             { "114",        "-58", },
0:             { "115",        "-61", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_2 order by a" ), expectedResults );
1: 
0:         // import running in insert mode does not reset the sequence counter
0: 		s.execute( "call syscs_util.syscs_import_data( null, 'T_4437_2', 'A', null, 'extin/" + IMPORT_FILE_NAME + "', null, null, null, 0 )" );
0:         expectedResults = new String[][]
1:         {
0:             { "100",        "-64", },
0:             { "101",        "-67", },
0:             { "102",        "-70", },
0:             { "103",        "-73", },
0:             { "104",        "-76", },
0:             { "105",        "-79", },
0:             { "110",        "-46", },
0:             { "111",        "-49", },
0:             { "112",        "-52", },
0:             { "113",        "-55", },
0:             { "114",        "-58", },
0:             { "115",        "-61", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_2 order by a" ), expectedResults );
1: 
0:         s.execute( "drop table t_4437_2" );
1:     }
1:         
1:     /**
0:      * <p>
0:      * Test that deferred inserts work well with the sequence-generator-based identity generators.
0:      * </p>
1:      */
0:     public  void    test_4437_03_deferredInsert()   throws Exception
1:     {
1: 		Statement s = createStatement();
0:         String[][] expectedResults;
1: 
0: 		s.execute( "create table t_4437_3( a int, b smallint generated always as identity (start with 9990, increment by -10) )" );
0: 		s.execute( "insert into t_4437_3( a ) values (100), (101), (102), (103), (104), (105)" );
0:         expectedResults = new String[][]
1:         {
0:             { "100",        "9990", },
0:             { "101",        "9980", },
0:             { "102",        "9970", },
0:             { "103",        "9960", },
0:             { "104",        "9950", },
0:             { "105",        "9940", },
1:         };
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_3 order by a" ), expectedResults );
1: 
0:         // deferred inserts should continue the sequence where it left off
0: 		s.execute( "insert into t_4437_3( a ) select a + 10 from ( select a from t_4437_3 order by a ) s" );
0:         expectedResults = addResults
0:             (
0:              expectedResults,
0:              new String[][]
1:              {
0:                  { "110",        "9930", },
0:                  { "111",        "9920", },
0:                  { "112",        "9910", },
0:                  { "113",        "9900", },
0:                  { "114",        "9890", },
0:                  { "115",        "9880", },
1:              }
0:              );
0: 		JDBC.assertFullResultSet( s.executeQuery( "select * from t_4437_3 order by a" ), expectedResults );
1: 
0:         s.execute( "drop table t_4437_3" );
1:     }
1: 
0: 	public static Test suite()
1:     {
0: 		Test    cleanDatabaseSuite = new CleanDatabaseTestSetup(
/////////////////////////////////////////////////////////////////////////
1:         
0:         //
0:         // Copies the data file to a location which can be read.
0:         //
0:         Test        result = new SupportFilesSetup
0:             (
0:              cleanDatabaseSuite,
0:              new String [] { "functionTests/tests/lang/" + IMPORT_FILE_NAME }
0:              );
1: 
0:         return result;
commit:729be57
/////////////////////////////////////////////////////////////////////////
1: 
0:     private static  final   String  SEQUENCE_OVERFLOW = "2200H";
1:     
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"AIS","10","0","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"TAB1","6","1","1"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"APP     ","UserTran","TABLE   ","1  ","IX","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"}};
/////////////////////////////////////////////////////////////////////////
0: 		assertStatementError(SEQUENCE_OVERFLOW, pst,"insert into ai_over1 (x) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)");
0: 		assertStatementError(SEQUENCE_OVERFLOW, pst,"insert into ai_over1 (x) values (1)");		
0: 		assertStatementError(SEQUENCE_OVERFLOW, pst,"insert into ai_over2 (x) values (9),(10)");
/////////////////////////////////////////////////////////////////////////
0: 		assertStatementError(SEQUENCE_OVERFLOW, pst,"insert into ai_over3 (x) select x from ai_over3");			
0: 		s.executeUpdate("insert into ai_over4 (x) values (1),(2),(3)");
0: 		assertStatementError(SEQUENCE_OVERFLOW, pst,"insert into ai_over4 (x) values (4)");
0: 		expectedRows=new String[][]{{"1","9223372036854775805"},{"2","9223372036854775806"},{"3","9223372036854775807"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"REC11","12","2","2"}};
/////////////////////////////////////////////////////////////////////////
0: 		expectedRows=new String[][]{{"LOCKC11","6","1","1"}};
author:Knut Anders Hatlen
-------------------------------------------------------------------------------
commit:b5392db
/////////////////////////////////////////////////////////////////////////
1: 
1:         String[][] expectedRows = {
1:             {"1", "10"},
1:             {"2", "11"},
1:             {"3", "12"},
1:             {"4", "13"},
1:             {"5", "14"},
1:             {"6", "15"},
0:         };
1: 
1:         assertUpdateCount(pst, 0, "alter table base add column y "
1:                 + "smallint generated always as identity (start with 10)");
1:         JDBC.assertFullResultSet(
1:                 pst.executeQuery("select * from base order by x"),
1:                 expectedRows);
1:         assertUpdateCount(pst, 0, "alter table base drop column y");
1: 
1:         assertUpdateCount(pst, 0, "alter table base add column y "
1:                 + "int generated always as identity (start with 10)");
1:         JDBC.assertFullResultSet(
1:                 pst.executeQuery("select * from base order by x"),
1:                 expectedRows);
1:         assertUpdateCount(pst, 0, "alter table base drop column y");
1: 
1:         assertUpdateCount(pst, 0, "alter table base add column y "
1:                 + "bigint generated always as identity (start with 10)");
1:         JDBC.assertFullResultSet(
1:                 pst.executeQuery("select * from base order by x"),
1:                 expectedRows);
1:         assertUpdateCount(pst, 0, "alter table base drop column y");
1: 
1:         assertUpdateCount(pst, 0, "alter table base add column y "
1:                 + "bigint generated always as identity (start with 10)");
1:         JDBC.assertFullResultSet(
1:                 pst.executeQuery("select * from base order by x"),
1:                 expectedRows);
1:         assertUpdateCount(pst, 0, "alter table base drop column y");
1: 
1:         expectedRows = new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"}};
/////////////////////////////////////////////////////////////////////////
1:         JDBC.assertFullResultSet(rs, expectedRows);
author:Dag H. Wanvik
-------------------------------------------------------------------------------
commit:1ae02c9
/////////////////////////////////////////////////////////////////////////
1: import org.apache.derbyTesting.junit.BaseTestSuite;
/////////////////////////////////////////////////////////////////////////
1:             new BaseTestSuite(AutoIncrementTest.class, "AutoIncrementTest")) {
author:Myrna van Lunteren
-------------------------------------------------------------------------------
commit:3d7c3d5
/////////////////////////////////////////////////////////////////////////
0: /**
1:  *  Derby - Class org.apache.derbyTesting.functionTests.tests.lang.AutoIncrementTest
1:  *  
1:  * Licensed to the Apache Software Foundation (ASF) under one
1:  * or more contributor license agreements.  See the NOTICE file
1:  * distributed with this work for additional information
1:  * regarding copyright ownership.  The ASF licenses this file
1:  * to you under the Apache License, Version 2.0 (the
1:  * "License"); you may not use this file except in compliance
1:  * with the License.  You may obtain a copy of the License at
1:  *
1:  *   http://www.apache.org/licenses/LICENSE-2.0
1:  *
1:  * Unless required by applicable law or agreed to in writing,
1:  * software distributed under the License is distributed on an
1:  * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
1:  * KIND, either express or implied.  See the License for the
1:  * specific language governing permissions and limitations
1:  * under the License.
0:  */
1: 
1: package org.apache.derbyTesting.functionTests.tests.lang;
1: 
1: import java.sql.Connection;
1: import java.sql.PreparedStatement;
1: import java.sql.ResultSet;
1: import java.sql.SQLException;
1: import java.sql.Statement;
1: 
1: import junit.framework.Test;
0: import junit.framework.TestSuite;
1: 
1: import org.apache.derbyTesting.junit.BaseJDBCTestCase;
1: import org.apache.derbyTesting.junit.CleanDatabaseTestSetup;
1: import org.apache.derbyTesting.junit.JDBC;
1: 
1: public class AutoIncrementTest extends BaseJDBCTestCase {
1: 	public AutoIncrementTest(String name)
1: 	{
1: 		super (name);
1: 	}
0: 	/**
1: 	 * converted from autoincrement.sql.  
1: 	 * @throws SQLException
0: 	 */
1: 	private static void createSchemaObjects(Statement st)
1: 	throws SQLException
1: 	{
1: 		
1: 		st.executeUpdate("create table ai_zero (i int, a_zero int generated always as identity)");
1: 		st.executeUpdate("create table ai_one (i int, a_one smallint generated always as identity)");
1: 		st.executeUpdate("create table ai_two (i int, a_two int generated always as identity)");
1: 		st.executeUpdate("create table ai_three (i int, a_three int generated always as identity)");
1: 		st.executeUpdate("create table ai (i  int, autoinc int generated always as identity (start with 100))");
1: 		st.executeUpdate("create table ai1 (i int, autoinc1 int generated always as identity (increment by 100))");
1: 		st.executeUpdate("create table ai2 (i int,autoinc2 int generated always as identity (start with 101, increment by 100))"); 
1: 		st.executeUpdate("create table ai3 (i int,a11 int generated always as identity (start with  0, increment by -1))");
1: 		st.executeUpdate("create table ai4 (i int,a21 int generated always as identity (start with  +0, increment by -1))");
1: 		st.executeUpdate("create table ai5 (i int, a31 int generated always as identity (start with  -1, increment by -1))");
1: 		st.executeUpdate("create table ai6 (i int, a41 int generated always as identity (start with  -11, increment by +100))");
1: 		//-- **** simple increment tests.
1: 		st.executeUpdate("create table ai_short (i int,ais smallint generated always as identity (start with 0, increment by 2))");
1: 		st.executeUpdate("create table ai_single1 (i int, a0 int generated always as identity (start with  -1, increment by -1))");
1: 		st.executeUpdate("create table ai_single2 (i int, a1 smallint generated always as identity)");
1: 		st.executeUpdate("create table ai_single3 (i int, a2 int generated always as identity (start with 0))");
1: 		st.executeUpdate("create table ai_single4 (i int, a3 bigint generated always as identity(start with  -100, increment by 10))");
1: 
1: 
1: 		st.executeUpdate("create table ai_test (x int generated always as identity (start with 2, increment by 2),y int)");
1: 
1: 		st.executeUpdate("create table ai_single1conn (c char(100), a_odd int generated always as identity (start with 1, increment by 2))");
1: 		st.executeUpdate("create table ai_single2conn (c char(100), a_even int generated always as identity (start with 0, increment by 2))");
1: 		st.executeUpdate("create table ai_single3conn (c char(100), a_sum bigint generated always as identity (start with 1, increment by 2))");
1: 		
1: 		//-- triggers 
1: 		st.executeUpdate("create table t1 (c1 int generated always as identity, name char(32))");
1: 		st.executeUpdate("create table t2 (c2 int generated always as identity, name char(32))");
1: 		st.executeUpdate("create trigger insert_trigger after insert on t1 for each row insert into t2 (name) values ('Bob Finocchio')");		
1: 		st.executeUpdate("create table tab1(s1 int generated always as identity,lvl int)");
1: 		st.executeUpdate("create table tab3 (c1 int)");
1: 		st.executeUpdate("create trigger tab1_after1 after insert on tab3 referencing new as newrow for each row insert into tab1 (lvl) values 1,2,3");
1: 		st.executeUpdate("create table tab1schema (i int, a1 int generated always as identity (start with -1, increment by -1))");
1: 		st.executeUpdate("create table tab2schema (i int, a2 smallint generated always as identity (start with 1, increment by +1))");
1: 		st.executeUpdate("create table tab3schema (i int, a1 int generated always as identity (start with 0, increment by -2))");
1: 		st.executeUpdate("create table tab4schema (i int, a2 bigint generated always as identity (start with 0, increment by 2))");		
1: 
1: 		st.executeUpdate("create table t1_1 (x int, s1 int generated always as identity)");
1: 		st.executeUpdate("create table t2_1 (x smallint, s2 int generated always as identity (start with 0))");
1: 		st.executeUpdate("create table t1_2 (s1 int generated always as identity)");
1: 		st.executeUpdate("alter table t1_2 add column x int");		
1: 		st.executeUpdate("create table t2_2 (s2 int generated always as identity (start with 2))");
1: 		st.executeUpdate("alter table t2_2 add column x int");
1: 		st.executeUpdate("create table t3_2 (s0 int generated always as identity (start with 0))");
1: 		st.executeUpdate("alter table t3_2 add column x int");
1: 		//-- test some more generated column specs
1: 		st.executeUpdate("create table trigtest (s1 smallint generated always as identity, lvl int)");
1: 		st.executeUpdate("create table t1_col (x char(2) default 'yy', y bigint generated always as identity)");
1: 		//conn.setAutoCommit(false);
1: 		st.executeUpdate("create table testme (text varchar(10), autonum int generated always as identity)");
1: 		//conn.commit();		
1: 		st.executeUpdate("create table ai_neg (x smallint generated always as identity, y int)");
1: 		st.executeUpdate("create table ai_over1 (x int, y int generated always as identity (increment by 200000000))");
1: 		st.executeUpdate("create table ai_over2 (x int, y smallint generated always as identity (start with  -32760, increment by -1))");
1: 		st.executeUpdate("create table ai_over3 (x int, y int generated always as identity (start with  2147483646))");
1: 		st.executeUpdate("create table ai_over4 (x int, y bigint generated always as identity(start with     9223372036854775805))");
1: 		st.executeUpdate("create table base (x int)");
1: 		// testing non-reserved keywords: generated, start, always
1: 		// should be successful
1: 		st.executeUpdate("create table always (a int)");
1: 		st.executeUpdate("create table start (a int)");
1: 		st.executeUpdate("create table generated (a int)");
1: 		st.executeUpdate("create table idt1(c1 int generated always as identity, c2 int)");
1: 		st.executeUpdate("create table autoinct2 (a int, b int generated always as identity)");
1: 		st.executeUpdate("create table autoinct1(c1 int generated always as identity)");
1: 		st.executeUpdate("create table autoinct3(c1 int generated always as identity (increment by 3))");
1: 		st.execute("create table withinct1(i int, withinct1_autogen int generated always as identity)");
1: 		st.execute("create table withinct2(i int, withinct2_autogen int generated by default as identity)");
1: 		st.execute("create table withinctempt1(i int, withinct1_autogen int generated always as identity)");
1: 		st.execute("create table withinctempt2(i int, withinct2_autogen int generated by default as identity)");
1: 		st.execute("create table withinct3(i int, withinct3_autogen int generated always as identity(increment by 10))");
1: 		st.execute("create table withinct4(i int, withinct4_autogen int generated by default as identity(increment by 10))");
1: 		st.execute("create table variantt1 (c11 int generated always as identity (start with 101, increment by 3), c12 int)");
1: 		st.execute("create table variantt2 (c21 int generated always as identity (start with 201, increment by 5), c22 int)");
1: 		st.execute("create trigger variantt1tr1 after insert on variantt1 for each row insert into variantt2 (c22) values (1)");
1: 		st.execute("create table restartt1 (rec11 int generated by default as identity(start with 2, increment by 2), c12 int)");
1: 		st.execute("create table t1lock(lockc11 int generated by default as identity (start with 1, increment by 1), c12 int)");
1: 		st.execute("create unique index t1locki1 on t1lock(lockc11)");
1: 		//-- Since RESTART is not a reserved keyword, we should be able to create a table with name RESTART
1: 		st.execute("create table restart (c11 int)");
1: 		st.execute("create table newTable (restart int)");
1: 		st.execute("create table newTable2 (c11 int)");
1: 		st.execute("alter table newTable2 add column RESTART int");
1: 		st.execute("CREATE TABLE DERBY_1495 (testid INT GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) NOT NULL,testcol2 INT NOT NULL)");
1: 		st.execute("create table derby_1645 (testTableId INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,testStringValue VARCHAR(20) not null,constraint PK_derby_1645 primary key (testTableId))");
1: 		st.execute("create table D1644 (d1644c1 int, d1644c2 int generated by default as identity)");
1: 		st.execute("create table D1644_A (d1644_Ac1 int, d1644_Ac2 int generated by default as identity, c3 int)");
1: 		st.execute("create table D1644_B (d1644_Bc1 int generated by default as identity)");
1: 		st.execute("create table d4006 (x varchar(5) default 'abc')");
1: 		st.execute("create table d4006_a (z int generated always as identity)");
0: 		st.execute("alter table d4006_a alter column z default 99");
0: 		st.execute("alter table d4006_a alter column z default null");
1: 		st.execute("create table d4419_t1(x int)");
1: 		st.execute("insert into d4419_t1 values 1,2");
1: 		st.execute("create table d4419_t2(x int)");
1: 		st.execute("insert into d4419_t2 values 2,3");
1: 		st.execute("create table d4419_t3(x int, y int generated always as identity)");
1: 		st.execute("insert into d4419_t3(x) select * from d4419_t1 union select * from d4419_t2");
1: 		st.execute("create table lockt1 (x int, yyyy int generated always as identity (start with  0))");
1: 		st.execute("create view lock_table as select cast(username as char(8)) as username, cast(t.type as char(8)) as trantype,cast(l.type as char(8)) as type, cast(lockcount as char(3)) as cnt, mode, cast(tablename as char(12)) as tabname,state, status from  syscs_diag.lock_table l right outer join syscs_diag.transaction_table t on l.xid = t.xid  where t.type='UserTransaction' and l.lockcount is not null");
1: 		st.execute("create table uniquet1(i int, t1_autogen int generated always as identity(start with 100, increment by 20))");
1: 		st.execute("create table uniquet2(i int, t2_autogen int generated by default as identity(start with 100, increment by 20))");
1: 		st.execute("create table uniquetempt1(i int, t1_autogen int generated always as identity(start with 100, increment by 20))");
1: 		st.execute("create table uniquetempt2(i int, t2_autogen int generated by default as identity(start with 100, increment by 20))");
1: 		st.execute("create table uniquet3(i int,uniquet3_autogen int generated by default as identity(start with 0, increment by 1) unique)");
1: 		st.execute("create table uniquet4(i int,uniquet4_autogen int generated by default as identity(start with 0, increment by 1))");
1: 		st.execute("create unique index idx_uniquet4_autogen on uniquet4(uniquet4_autogen)");
1: 		st.execute("create table withinctempt3(i int, t1_autogen int generated always as identity(increment by 10))");
1: 		st.execute("create table withinctempt4(i int, t2_autogen int generated by default as identity(increment by 10))");
1: 	}
1: 	public void testderbyIncrementTest() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s = createStatement();
0: 		rs = s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME in ('A_ZERO','A_ONE', 'A_TWO', 'A_THREE')");
0: 		String [][]expectedRows={{"A_ZERO","1","1","1"},
0: 				{"A_ONE","1","1","1"},{"A_TWO","1","1","1"},{"A_THREE","1","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testautoIncSysColTest()  throws Exception
1: 	{
1: 		ResultSet rs;
1: 		String [][]expectedRows;
1: 		
1: 		Statement s = createStatement();
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC'");
1: 		expectedRows=new String[][]{{"100","100","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC1'");
1: 		expectedRows=new String[][]{{"1","1","100"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AUTOINC2'");
1: 		expectedRows=new String[][]{{"101","101","100"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 	}
1: 	public void testnegative() throws Exception
1: 	{
1: 		//-- try -ive numbers.
1: 		ResultSet rs;
1: 		
1: 		
1: 		Statement s = createStatement();
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A11'");
1: 		String [][]expectedRows=new String[][]{{"0","0","-1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A21'");
1: 		expectedRows=new String[][]{{"0","0","-1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A31'");
1: 		expectedRows=new String[][]{{"-1","-1","-1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs = s.executeQuery("select AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'A41'");
1: 		expectedRows=new String[][]{{"-11","-11","100"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 
1: 	}
1: 	
1: 	public void testsimpleincrement() throws Exception
1: 	{
1: 		/*change*/
1: 		ResultSet rs;
1: 		Statement s = createStatement();
1: 		s.executeUpdate("insert into ai_short (i) values (0)");
1: 		s.executeUpdate("insert into ai_short (i) values (1)");
1: 		s.executeUpdate("insert into ai_short (i) values (2)");
1: 		s.executeUpdate("insert into ai_short (i) values (33)");
0: 		rs = s.executeQuery("select * from ai_short");
1: 		String[][]expectedRows=new String[][]{{"0","0"},{"1","2"},{"2","4"},{"33","6"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs = s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'AIS'");
0: 		expectedRows=new String[][]{{"AIS","8","0","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testonegeneratedcolumn() throws Exception
1: 	{
1: 		//-- table with one generated column spec should succeed
1: 		ResultSet rs;
1: 		Statement s = createStatement();
0: 		Integer i=new Integer(1);
1: 
1: 		while (i.intValue()< 11)
1: 		{
1: 			String mysql="insert into ai_single1 (i) values ("+i.toString()+")";
1: 			s.executeUpdate(mysql);
1: 			mysql="insert into ai_single2 (i) values ("+i.toString()+")";
1: 			s.executeUpdate(mysql);
1: 			mysql="insert into ai_single3 (i) values ("+i.toString()+")";
1: 			s.executeUpdate(mysql);
1: 			mysql="insert into ai_single4 (i) values ("+i.toString()+")";
1: 			s.executeUpdate(mysql);
1: 			int j=i.intValue()+1;
0: 			i=new Integer(j);
1: 		}
0: 		rs = s.executeQuery("select a.i, a0, a1, a2, a3 from ai_single1 a join ai_single2 b on a.i = b.i join ai_single3 c on a.i = c.i join ai_single4 d on a.i = d.i");
1: 		String[][]expectedRows=new String[][]{{"1","-1","1","0","-100"},{"2","-2","2","1","-90"},
1: 				{"3","-3","3","2","-80"},{"4","-4","4","3","-70"},
1: 				{"5","-5","5","4","-60"},{"6","-6","6","5","-50"},
1: 				{"7","-7","7","6","-40"},{"8","-8","8","7","-30"},
1: 				{"9","-9","9","8","-20"},{"10","-10","10","9","-10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("delete from ai_single1");
1: 		s.executeUpdate("delete from ai_single2");
1: 		s.executeUpdate("delete from ai_single3");
1: 		s.executeUpdate("delete from ai_single4");
1: 		s.executeUpdate("insert into ai_single1 (i) values (1)");
1: 		s.executeUpdate("insert into ai_single2 (i) values (1)");
1: 		s.executeUpdate("insert into ai_single3 (i) values (1)");
1: 		s.executeUpdate("insert into ai_single4 (i) values (1)");
1: 		rs=s.executeQuery("select a.i, a0, a1, a2, a3 from ai_single1 a join ai_single2 b on a.i = b.i join ai_single3 c on a.i = c.i join ai_single4 d on a.i = d.i");
1: 		expectedRows=new String[][]{{"1","-11","11","10","0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		//-- table with more than one generated column spec should fail
1: 		assertStatementError("428C1", s,"create table ai_multiple (i int, a0 int generated always as identity (start with  -1,increment by -1),a1 smallint generated always as identity,a2 int generated always as identity (start with  0),a3 bigint generated always as identity (start with  -100,increment by 10))");
1: 
1: 	}
1: 	public void testConnectionInfo() throws Exception
1: 	{
1: 		//-- **** connection info tests {basic ones}
1: 		ResultSet rs;
1: 		Statement s = createStatement();
1: 		s.executeUpdate("insert into ai_test (y) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		String[][]expectedRows=new String[][]{{null}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_test (y) select y+10 from ai_test");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");		
1: 		//-- try some more connection info tests
1: 		expectedRows=new String[][]{{null}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single1conn (c) values ('a')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single2conn (c) values ('a')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single3conn (c) values ('a')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single1conn (c) values ('b')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single2conn (c) values ('b')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into ai_single3conn (c) values ('b')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testTrigger() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.executeUpdate("insert into t1 (name) values ('Phil White')");
1: 		rs=s.executeQuery("select * from t1");
1: 		String[][]expectedRows=new String[][]{{"1","Phil White"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select * from t2");
1: 		expectedRows=new String[][]{{"1","Bob Finocchio"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t2 (name) values ('Jean-Yves Dexemier')");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		
1: 	}
1: 	public void testSchema() throws Exception
1: 	{
1: 		//-- insert into multiple tables in different schema names with same tablename,column names
1: 		//-- make sure 
1: 		//-- lastAutoincrementValue shouldn't get confused.....
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.executeUpdate("create schema BPP");
1: 		s.executeUpdate("set schema BPP");
1: 		s.executeUpdate("create table tab1schema (i int, a1 int generated always as identity (start with 100, increment by 1))");
1: 		s.executeUpdate("create table tab2schema (i int, a2 bigint generated always as identity (start with 100, increment by -1))");
1: 		s.executeUpdate("create table tab3schema (i int, a1 int generated always as identity (start with 100, increment by 2))");
1: 		s.executeUpdate("create table tab4schema (i int, a2 smallint generated always as identity (start with 100, increment by -2))");
1: 		s.executeUpdate("insert into APP.tab1schema (i) values (1)");
1: 		s.executeUpdate("insert into APP.tab2schema (i) values (1)");
1: 		s.executeUpdate("insert into APP.tab3schema (i) values (1)");
1: 		s.executeUpdate("insert into APP.tab4schema (i) values (1)");
1: 		s.executeUpdate("insert into tab1schema (i) values (1)");
1: 		s.executeUpdate("insert into tab1schema (i) values (2)");
1: 		s.executeUpdate("insert into tab2schema (i) values (1)");
1: 		s.executeUpdate("insert into tab2schema (i) values (2)");
1: 		s.executeUpdate("insert into tab3schema (i) values (1)");
1: 		s.executeUpdate("insert into tab3schema (i) values (2)");
1: 		s.executeUpdate("insert into tab4schema (i) values (1)");
1: 		s.executeUpdate("insert into tab4schema (i) values (2)");
1: 		rs=s.executeQuery("select a.i, a1, a2 from app.tab1schema a join app.tab2schema b on a.i = b.i");
1: 		String[][]expectedRows=new String[][]{{"1","-1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select a.i, a1, a2 from app.tab3schema a join app.tab4schema b on a.i = b.i");
1: 		expectedRows=new String[][]{{"1","0","0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select a.i, a1, a2 from tab1schema a join tab2schema b on a.i = b.i");
1: 		expectedRows=new String[][]{{"1","100","100"},{"2","101","99"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select a1, a2, a.i from tab3schema a join tab4schema b on a.i = b.i");
1: 		expectedRows=new String[][]{{"100","100","1"},{"102","98","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"98"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("set schema APP");
1: 		s.executeUpdate("drop table BPP.tab1schema");
1: 		s.executeUpdate("drop table BPP.tab2schema");
1: 		s.executeUpdate("drop table BPP.tab3schema");
1: 		s.executeUpdate("drop table BPP.tab4schema");
1: 		s.executeUpdate("drop schema BPP restrict");
1: 		s.executeUpdate("insert into tab3 values null");
0: 		rs=s.executeQuery("select * from tab1");
1: 		expectedRows=new String[][]{{"1","1"},{"2","2"},{"3","3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select b.tablename, a.autoincrementvalue, a.autoincrementstart, a.autoincrementinc from sys.syscolumns a, sys.systables b where a.referenceid=b.tableid and a.columnname ='S1' and b.tablename = 'TAB1'");
0: 		expectedRows=new String[][]{{"TAB1","4","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("create table tab2 (lvl int, s1  bigint generated always as identity)");
1: 		s.executeUpdate("create trigger tab1_after2 after insert on tab3 referencing new as newrow for each row insert into tab2 (lvl) values 1,2,3");
1: 		s.executeUpdate("insert into tab3 values null");
0: 		rs=s.executeQuery("select * from tab2");
1: 		expectedRows=new String[][]{{"1","1"},{"2","2"},{"3","3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select b.tablename, a.autoincrementvalue, a.autoincrementstart, a.autoincrementinc from sys.syscolumns a, sys.systables b where a.referenceid=b.tableid and a.columnname ='S1' and b.tablename = 'TAB2'");
0: 		expectedRows=new String[][]{{"TAB2","4","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 	}
1: 	public void testadditionalSysCol() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.executeUpdate("insert into t1_1 (x) values (1)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		String[][]expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t1_1 (x) values (2)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t2_1 (x) values (1)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");		
1: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
0: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x");
1: 		expectedRows=new String[][]{{"1","1","2","0"},{"2","2","3","1"},{"3","3","4","2"},{"4","4","5","3"},{"5","5","6","4"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into trigtest (lvl) values (0)");
1: 		s.executeUpdate("insert into trigtest (lvl) values (1),(2)");
1: 		s.executeUpdate("insert into trigtest (lvl) values (3),(4)");
1: 		s.executeUpdate("insert into trigtest (lvl) values (5),(6)");
1: 		s.executeUpdate("insert into trigtest (lvl) values (7),(8)");
0: 		rs=s.executeQuery("select * from trigtest");
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"5","4"},{"6","5"},{"7","6"},{"8","7"},{"9","8"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select count(*) from t1_2");
1: 		expectedRows=new String[][]{{"5"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("delete from t1_2");
1: 		s.executeUpdate("delete from t2_2");
1: 		s.executeUpdate("delete from t3_2");
1: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");
1: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
0: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x");
1: 		expectedRows=new String[][]{{"1","6","7","5"},{"2","7","8","6"},{"3","8","9","7"},{"4","9","10","8"},{"5","10","11","9"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t1_2 (x) values (6)");
1: 		s.executeUpdate("insert into t2_2 (x) values (6)");
1: 		s.executeUpdate("insert into t3_2 (x) values (6)");
0: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2  a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x");
1: 		expectedRows=new String[][]{{"1","6","7","5"},{"2","7","8","6"},{"3","8","9","7"},{"4","9","10","8"},{"5","10","11","9"},{"6","11","12","10"}};
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("delete from t1_2");
1: 		s.executeUpdate("delete from t2_2");
1: 		s.executeUpdate("delete from t3_2");
1: 		s.executeUpdate("insert into t1_2 (x) values (1),(2),(3),(4),(5)");
1: 		s.executeUpdate("insert into t2_2 (x) values (1),(2),(3),(4),(5)");
1: 		s.executeUpdate("insert into t3_2 (x) values (1),(2),(3),(4),(5)");
0: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x");
1: 		expectedRows=new String[][]{{"1","12","13","11"},{"2","13","14","12"},{"3","14","15","13"},{"4","15","16","14"},{"5","16","17","15"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into t1_2 (x) values (6)");
1: 		s.executeUpdate("insert into t2_2 (x) values (6)");
1: 		s.executeUpdate("insert into t3_2 (x) values (6)");
0: 		rs=s.executeQuery("select a.x, s1, s2, s0 from t1_2 a join t2_2 b on a.x = b.x join t3_2 c on a.x = c.x");
1: 		expectedRows=new String[][]{{"1","12","13","11"},{"2","13","14","12"},{"3","14","15","13"},{"4","15","16","14"},{"5","16","17","15"},{"6","17","18","16"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"16"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testsyslocks()throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		setAutoCommit(false);
1: 		s.execute("insert into lockt1 (x) values (1)");
1: 		s.execute("insert into lockt1 (x) values (2)");
0: 		rs=s.executeQuery("select * from lockt1");
1: 		String[][]expectedRows=new String[][]{{"1","0"},{"2","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
1: 		//Utilities.showResultSet(rs);
0: 		expectedRows=new String[][]{{"APP   ","UserTran","TABLE   ","2  ","IX","LOCKT1      ","GRANT","ACTIVE"},{"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},{"APP   ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("delete from lockt1");
1: 		commit();
1: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
1: 		expectedRows=new String[][]{};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("set isolation serializable");
1: 		rs=s.executeQuery("select columnname, autoincrementvalue from sys.syscolumns where columnname = 'YYYY'");
0: 		expectedRows=new String[][]{{"APP     ","UserTran","TABLE   ","1   ","S   ","SYSCOLUMNS  ","GRANT","ACTIVE"}};
1: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
0: 		expectedRows=new String[][]{{"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into lockt1 (x) values (3)");
1: 		rs=s.executeQuery("select * from lock_table order by tabname, type desc, mode, cnt");
0: 		expectedRows=new String[][]{{"APP     ","UserTran","TABLE   ","1  ","IX","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","ROW     ","1  ","X","LOCKT1      ","GRANT","ACTIVE"},{"APP     ","UserTran","TABLE   ","1  ","IX","SYSCOLUMNS  ","GRANT","ACTIVE"},{"APP     ","UserTran","TABLE   ","1  ","S","SYSCOLUMNS  ","GRANT","ACTIVE"},{"APP     ","UserTran","ROW     ","2  ","X","SYSCOLUMNS  ","GRANT","ACTIVE"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		commit();
1: 		
1: 	}
1: 	public void testColoumnSpecs() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		
1: 		
1: 		s.executeUpdate("insert into t1_col (x, y) values ('aa', default)");
1: 		s.executeUpdate("insert into t1_col values ('bb', default)");
1: 		s.executeUpdate("insert into t1_col (x) values default");
1: 		s.executeUpdate("insert into t1_col (x) values null");
1: 		//-- switch the order of the columns
1: 		s.executeUpdate("insert into t1_col (y, x) values (default, 'cc')");
0: 		rs=s.executeQuery("select * from t1_col");
1: 		String[][]expectedRows=new String[][]{{"aa","1"},{"bb","2"},{"yy","3"},{null,"4"},{"cc","5"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testbug3450() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		PreparedStatement ps=prepareStatement("insert into testme (text) values ?");
1: 		//PreparedStatement ps=conn.prepareStatement();
1: 		ps.setString(1, "one");
1: 		ps.execute();
1: 		ps.setString(1, "two");;
1: 		ps.execute();
1: 		ps.setString(1, "three");;
1: 		ps.execute();
0: 		rs=s.executeQuery("select * from testme");
1: 		String[][]expectedRows=new String[][]{{"one","1"},{"two","2"},{"three","3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		//-- give exact query and make sure that the statment cache doesn't
1: 		//-- mess up things.
1: 		ps.setString(1, "four");
1: 		ps.execute();
1: 		ps.setString(1, "four");
1: 		ps.execute();
0: 		rs=s.executeQuery("select * from testme");
1: 		expectedRows=new String[][]{{"one","1"},{"two","2"},{"three","3"},{"four","4"},{"four","5"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("drop table testme");
1: 
1: 	}
1: 	public void testnegativeinvalidtype() throws Exception
1: 	{
1: 		//-- negative tests from autoincrementNegative.sql
1: 		//-- negative bind tests.
1: 		//-- invalid types
1: 		ResultSet rs;
1: 		Statement pst=createStatement();
1: 		Statement s=createStatement(); 
1: 		
1: 		assertStatementError("42Z22",  pst,"create table ni (x int, y char(1) generated always as identity)");
1: 		assertStatementError("42Z22", pst,"create table ni (x int, y decimal(5,2) generated always as identity)");
1: 		assertStatementError("42Z22", pst,"create table ni (x int, y float generated always as identity (start with 1, increment by 1))");
1: 		assertStatementError("42Z22", pst,"create table ni (s int, y varchar(10) generated always as identity)");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (start with 0, increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y smallint generated always as identity (increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y smallint generated always as identity (start with 0, increment by 0))");
1: 		assertStatementError("42X01", pst,"create table ni (x int, y int generated always as identity (increment by 0)");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y int generated always as identity (start with 0, increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (start with 0, increment by 0))");
1: 		assertStatementError("42Z21", pst,"create table ni (x int, y bigint generated always as identity (start with 0, increment by 0))");
1: 		assertStatementError("22003", pst,"create table ni (x int, y smallint generated always as identity (start with 32768))");
1: 		assertStatementError("22003", pst,"create table ni (x int, y smallint generated always as identity (start with -32769))");
1: 		assertStatementError("22003", pst,"create table ni (x int, y int generated always as identity (start with  2147483648))");
1: 		assertStatementError("22003", pst,"create table ni (x int, y int generated always as identity (start with  -2147483649))");
1: 		assertStatementError("42X49", pst,"create table ni (x int, y int generated always as identity (start with  9223372036854775808))");
1: 		assertStatementError("42X49", pst,"create table ni (x int, y bigint  generated always as identity (start with  -9223372036854775809))");
1: 		s.executeUpdate("insert into ai_neg (y) values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)");
0: 		rs=s.executeQuery("select * from ai_neg");
1: 		String[][]expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"5","4"},{"6","5"},{"7","6"},{"8","7"},{"9","8"},{"10","9"},{"11","10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("delete from ai_neg where y=8 OR y=4");
1: 		s.executeUpdate("insert into ai_neg (y) values (11),(13),(14),(15),(17),(18),(19)");
0: 		rs=s.executeQuery("select * from ai_neg");
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("update ai_neg set y=-y");
1: 		rs=s.executeQuery("select * from ai_neg order by x");
1: 		expectedRows=new String[][]{{"1","0"},{"2","-1"},{"3","-2"},{"4","-3"},{"6","-5"},{"7","-6"},{"8","-7"},{"10","-9"},{"11","-10"},{"12","-11"},{"13","-13"},{"14","-14"},{"15","-15"},{"16","-17"},{"17","-18"},{"18","-19"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("update ai_neg set y=-y");
1: 		rs=s.executeQuery("select * from ai_neg order by x");
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","3"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);		
1: 		s.executeUpdate("update ai_neg set y=4 where y=3"); // doubt WARNING 02000
1: 		rs=s.executeQuery("select * from ai_neg order by x");
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"3","2"},{"4","4"},{"6","5"},{"7","6"},{"8","7"},{"10","9"},{"11","10"},{"12","11"},{"13","13"},{"14","14"},{"15","15"},{"16","17"},{"17","18"},{"18","19"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42Z23", pst,"insert into ai_neg values (1,2)");
1: 
1: 	}
1: 	public  void testOverflow()throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement pst=createStatement();
1: 		Statement s=createStatement();
0: 		assertStatementError("22003", pst,"insert into ai_over1 (x) values (1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19)");
0: 		assertStatementError("22003", pst,"insert into ai_over1 (x) values (1)");		
1: 		s.executeUpdate("insert into ai_over2 (x) values (1),(2),(3),(4),(5),(6),(7),(8)");
0: 		assertStatementError("22003", pst,"insert into ai_over2 (x) values (9),(10)");
1: 		String[][]expectedRows=new String[][]{{"1","-32760"},{"2","-32761"},{"3","-32762"},{"4","-32763"},{"5","-32764"},{"6","-32765"},{"7","-32766"},{"8","-32767"}};
0: 		rs=s.executeQuery("select * from ai_over2");
1: 		JDBC.assertFullResultSet(rs,expectedRows);		
1: 		s.executeUpdate("insert into ai_over3 (x) values (1)");
1: 		s.executeUpdate("insert into ai_over3 (x) values (2)");
0: 		rs=s.executeQuery("select * from ai_over3");
1: 		expectedRows=new String[][]{{"1","2147483646"},{"2","2147483647"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		assertStatementError("22003", pst,"insert into ai_over3 (x) select x from ai_over3");			
1: 		//bigint overflow check		
0: 		s.executeUpdate("insert into ai_over4 (x) values (1),(2)");
0: 		assertStatementError("22003", pst,"insert into ai_over4 (x) values (3)");
0: 		rs=s.executeQuery("select * from ai_over4");
0: 		expectedRows=new String[][]{{"1","9223372036854775805"},{"2","9223372036854775806"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testIdentity()throws Exception
1: 	{
1: 		//-- IDENTITY_VAL_LOCAL function, same as DB2, beetle 5354
1: 		ResultSet rs;
1: 		Statement pst=createStatement();
1: 		Statement s=createStatement();
1: 		pst.executeUpdate("insert into base values (1),(2),(3),(4),(5),(6)");
0: 		assertStatementError("42601", pst,"alter table base add column y smallint generated always as identity (start with  10)");
0: 		assertStatementError("42601", pst,"alter table base add column y int generated always as identity (start with  10)");
0: 		assertStatementError("42601", pst,"alter table base add column y bigint generated always as identity (start with  10)");
0: 		assertStatementError("42601", pst,"alter table base add column y bigint generated always as identity (start with  10)");
0: 		rs=pst.executeQuery("select * from base");
0: 		String[][]expectedRows=new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) values (8)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select IDENTITY_VAL_LOCAL()+1, IDENTITY_VAL_LOCAL()-1 from idt1");
1: 		expectedRows=new String[][]{{"2","0"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) values (IDENTITY_VAL_LOCAL())");
0: 		rs=s.executeQuery("select * from idt1");
1: 		expectedRows=new String[][]{{"1","8"},{"2","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select IDENTITY_VAL_LOCAL()+1, IDENTITY_VAL_LOCAL()-1 from idt1");
1: 		expectedRows=new String[][]{{"3","1"},{"3","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) values (8), (9)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select * from idt1");
1: 		expectedRows=new String[][]{{"1","8"},{"2","1"},{"3","8"},{"4","9"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) select c1 from idt1");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		rs=s.executeQuery("select * from idt1");
1: 		expectedRows=new String[][]{{"1","8"},{"2","1"},{"3","8"},{"4","9"},{"5","1"},{"6","2"},{"7","3"},{"8","4"}};
1: 		s.executeUpdate("delete from idt1");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) select c1 from idt1");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into idt1(c2) values (8)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"9"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testdefaultautoincrement() throws Exception
1: 	{
1: 		//-- test cases for beetle 5404: inserting multiple rows of defaults into autoincrement column.
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		Statement pst=createStatement();
1: 		s.executeUpdate("insert into autoinct1 values (default)");
1: 		rs=s.executeQuery("select * from autoinct1");
1: 		String[][]expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);		
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (1), (1)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (1), (default)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (1)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (default), (2)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (2)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct1 values (default), (default), (2), (default)");
1: 		s.executeUpdate("insert into autoinct1 values (default), (default)");
1: 		rs=s.executeQuery("select * from autoinct1");
1: 		expectedRows=new String[][]{{"1"},{"2"},{"3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into autoinct1 values (default), (default), (default)");
1: 		rs=s.executeQuery("select * from autoinct1");
1: 		expectedRows=new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into autoinct1 values (default), (default), (default),(default)");
1: 		rs=s.executeQuery("select * from autoinct1");
1: 		expectedRows=new String[][]{{"1"},{"2"},{"3"},{"4"},{"5"},{"6"},{"7"},{"8"},{"9"},{"10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 		s.executeUpdate("insert into autoinct2 values (1, default), (2, default)");
0: 		rs=s.executeQuery("select * from autoinct2");
1: 		expectedRows=new String[][]{{"1","1"},{"2","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42Z23", pst,"insert into autoinct2 values (1, default), (2, 2)");
1: 		assertStatementError("42Z23", pst,"insert into autoinct2 values (1, default), (2, default), (2, 2)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct2 values (1, 2), (2, default), (2, default)");
1: 
1: 		s.executeUpdate("insert into autoinct3 values (default)");
1: 		rs=s.executeQuery("select * from autoinct3");
1: 		expectedRows=new String[][]{{"1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into autoinct3 values (default)");
1: 		rs=s.executeQuery("select * from autoinct3");
1: 		expectedRows=new String[][]{{"1"},{"4"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (1), (default)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (1)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (default), (2)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (2)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 values (default), (default), (2), (default)");
1: 		assertStatementError("42Z23",pst,"insert into autoinct3 select * from autoinct1");
1: 		s.executeUpdate("insert into autoinct3 values (default), (default)");
1: 		rs=s.executeQuery("select * from autoinct3");
1: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into autoinct3 values (default), (default), (default)");
1: 		rs=s.executeQuery("select * from autoinct3");
1: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"},{"13"},{"16"},{"19"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("insert into autoinct3 values (default), (default), (default),(default)");
1: 		rs=s.executeQuery("select * from autoinct3");
1: 		expectedRows=new String[][]{{"1"},{"4"},{"7"},{"10"},{"13"},{"16"},{"19"},{"22"},{"25"},{"28"},{"31"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.executeUpdate("drop table autoinct1");
1: 		s.executeUpdate("drop table autoinct2");
1: 		s.executeUpdate("drop table autoinct3");
1: 
1: 
1: 	}
1: 	public void testwithIncrement()throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		Statement pst=createStatement();
1: 		s.execute("insert into withinct1(i) values(1)");
1: 		s.execute("insert into withinct1(i) values(1)");
0: 		rs=s.executeQuery("select * from withinct1");
1: 		String[][]expectedRows=new String[][]{{"1","1"},{"1","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into withinct2(i) values(1)");
1: 		s.execute("insert into withinct2(i) values(1)");
0: 		rs=s.executeQuery("select * from withinct2");
1: 		expectedRows=new String[][]{{"1","1"},{"1","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42Z23",pst,"insert into withinctempt1(i,withinct1_autogen) values(2,1)");
1: 		assertStatementError("42Z23",pst,"insert into withinctempt1(i,withinct1_autogen) values(2,2)");		
1: 		s.execute("insert into withinctempt1(i) values(2)");
1: 		s.execute("insert into withinctempt1(i) values(2)");
0: 		rs=s.executeQuery("select * from withinctempt1");
1: 		expectedRows=new String[][]{{"2","1"},{"2","2"}};		
1: 		//Utilities.showResultSet(rs);
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into withinctempt2(i,withinct2_autogen) values(2,1)");
1: 		s.execute("insert into withinctempt2(i,withinct2_autogen) values(2,2)");		
1: 		s.execute("insert into withinctempt2(i) values(2)");
1: 		s.execute("insert into withinctempt2(i) values(2)");
0: 		rs=s.executeQuery("select * from withinctempt2");
0: 		expectedRows=new String[][]{{"2","1"},{"2","2"},{"2","1"},{"2","2"}};		
1: 		JDBC.assertFullResultSet(rs,expectedRows);		
1: 		s.execute("insert into withinctempt3(i) values(1)");
1: 		s.execute("insert into withinctempt3(i) values(1)");			
0: 		rs=s.executeQuery("select * from withinctempt3");
1: 		expectedRows=new String[][]{{"1","1"},{"1","11"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into withinctempt4(i) values(1)");
1: 		s.execute("insert into withinctempt4(i) values(1)");			
0: 		rs=s.executeQuery("select * from withinctempt4");
1: 		expectedRows=new String[][]{{"1","1"},{"1","11"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42Z23",s,"insert into withinct3(i,withinct3_autogen) values(2,1)");
1: 		assertStatementError("42Z23",s,"insert into withinct3(i,withinct3_autogen) values(2,2)");
1: 		s.execute("insert into withinct3(i) values(2)");			
1: 		s.execute("insert into withinct3(i) values(2)");
0: 		rs=s.executeQuery("select * from withinct3");
1: 		expectedRows=new String[][]{{"2","1"},{"2","11"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into withinct4(i,withinct4_autogen) values(2,1)");
1: 		s.execute("insert into withinct4(i,withinct4_autogen) values(2,2)");
1: 		s.execute("insert into withinct4(i) values(2)");
1: 		s.execute("insert into withinct4(i) values(2)");
0: 		rs=s.executeQuery("select * from withinct4");
0: 		expectedRows=new String[][]{{"2","1"},{"2","2"},{"2","1"},{"2","11"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testunique()throws Exception
1: 	{	//--with unique constraint
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.execute("insert into uniquet1(i) values(1)");
1: 		s.execute("insert into uniquet1(i) values(1)");
1: 		String[][]expectedRows=new String[][]{{"1","100"},{"1","120"}};
0: 		rs=s.executeQuery("select * from uniquet1");
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into uniquet2(i) values(1)");
1: 		s.execute("insert into uniquet2(i) values(1)");
1: 		expectedRows=new String[][]{{"1","100"},{"1","120"}};
0: 		rs=s.executeQuery("select * from uniquet2");
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		
1: 		assertStatementError("42Z23",s,"insert into uniquetempt1(i,t1_autogen) values(2,1)");
1: 		assertStatementError("42Z23",s,"insert into uniquetempt1(i,t1_autogen) values(2,2)");
1: 		s.execute("insert into uniquetempt1(i) values(2)");
1: 		s.execute("insert into uniquetempt1(i) values(2)");
1: 		expectedRows=new String[][]{{"2","100"},{"2","120"}};
0: 		rs=s.executeQuery("select * from uniquetempt1");
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		
1: 		s.execute("insert into uniquetempt2(i,t2_autogen) values(2,1)");
1: 		s.execute("insert into uniquetempt2(i,t2_autogen) values(2,2)");
1: 		s.execute("insert into uniquetempt2(i) values(2)");
1: 		s.execute("insert into uniquetempt2(i) values(2)");
1: 		expectedRows=new String[][]{{"2","1"},{"2","2"},{"2","100"},{"2","120"}};
1: 		
1: 		//assertStatementError("23505",pst,"insert into uniquet3(i,uniquet3_autogen) values(1,0)");
1: 		s.execute("insert into uniquet3(i,uniquet3_autogen) values(1,0)");
1: 		//assertStatementError("23505",pst,"insert into uniquet3(i,uniquet3_autogen) values(2,1)");
1: 		s.execute("insert into uniquet3(i,uniquet3_autogen) values(2,1)");
1: 		assertStatementError("23505",s,"insert into uniquet3(i) values(3)");
1: 		assertStatementError("23505",s,"insert into uniquet3(i) values(4)");
1: 		s.execute("insert into uniquet3(i) values(5)");		
0: 		rs=s.executeQuery("select i,uniquet3_autogen from uniquet3");
1: 		//Utilities.showResultSet(rs);
1: 
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"5","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 
1: 		//--with unique index
1: 		s.execute("insert into uniquet4(i,uniquet4_autogen) values(1,0)");
1: 		s.execute("insert into uniquet4(i,uniquet4_autogen) values(2,1)");
1: 		assertStatementError("23505",s,"insert into uniquet4(i) values(3)");
1: 		assertStatementError("23505",s,"insert into uniquet4(i) values(4)");
1: 		s.execute("insert into uniquet4(i) values(5)");
0: 		rs=s.executeQuery("select i,uniquet4_autogen from uniquet4");
1: 		expectedRows=new String[][]{{"1","0"},{"2","1"},{"5","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 
1: 	}
1: 	public void testidvalconn()throws Exception
1: 	{
1: 		//-- test IDENTITY_VAL_LOCAL function with 2 different connections
1: 		ResultSet rs;
1: 		Connection conn1=openUserConnection("conn1");
1: 		Statement conn1st=conn1.createStatement();
1: 		conn1st.execute("create table idvalt1 (c11 int generated always as identity (start with 101, increment by 3), c12 int)");
1: 		conn1st.execute("create table idvalt2 (c21 int generated always as identity (start with 201, increment by 5), c22 int)");
1: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		String[][]expectedRows=new String[][]{{null}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn1.commit();
1: 		Connection conn2=openUserConnection("conn2");
1: 		Statement conn2st=conn2.createStatement();
1: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{null}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		//conn2st.executeUpdate("insert into idvalt2 (c22) values (1)");
1: 		conn2st.execute("insert into conn1.idvalt2 (c22) values (1)");
1: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"201"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn1=openUserConnection("conn1");
1: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{null}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn1st.execute("insert into idvalt1 (c12) values (1)");
1: 		rs=conn1st.executeQuery("values IDENTITY_VAL_LOCAL()");		
1: 		expectedRows=new String[][]{{"101"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn2st=conn2.createStatement();
1: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"201"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn2.commit();
1: 		conn2st=conn2.createStatement();
1: 		rs=conn2st.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		expectedRows=new String[][]{{"201"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		conn1st.execute("drop table idvalt1");
1: 		conn1st.execute("drop table idvalt2");
1: 
1: 	}
1: 	public void testidvalVariants()throws Exception
1: 	{
1: 		/*-- A table with identity column has an insert trigger which inserts into another table 
1: 		-- with identity column. IDENTITY_VAL_LOCAL will return the generated value for the 
1: 		-- statement table and not for the table that got modified by the trigger*/
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.execute("insert into variantt1 (c12) values (1)");
1: 		rs=s.executeQuery("values IDENTITY_VAL_LOCAL()");
1: 		String[][]expectedRows=new String[][]{{"101"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select * from variantt1");
0: 		expectedRows=new String[][]{{"101","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select * from variantt2");
1: 		expectedRows=new String[][]{{"201","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testrestart()throws Exception
1: 	{
1: 		//-- Test RESTART WITH syntax of ALTER TABLE for autoincrment columns
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'REC11'");
1: 
1: 		String[][]expectedRows=new String[][]{{"REC11","2","2","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into restartt1 values(2,2)");
1: 		rs=s.executeQuery("select * from restartt1");
1: 
1: 		expectedRows=new String[][]{{"2","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'REC11'");
1: 		expectedRows=new String[][]{{"REC11","2","2","2"}};									  
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into restartt1(c12) values(9999)");
1: 		rs=s.executeQuery("select * from restartt1");
0: 		expectedRows=new String[][]{{"2","2"},{"2","9999"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'REC11'");
0: 		expectedRows=new String[][]{{"REC11","4","2","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("42837",s,"alter table restartt1 alter column c12 RESTART WITH 2");
1: 		assertStatementError("42X49",s,"alter table restartt1 alter column rec11 RESTART WITH 2.20");
1: 		s.execute("alter table restartt1 alter column rec11 RESTART WITH 2");
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC	from sys.syscolumns where COLUMNNAME = 'REC11'");
1: 		expectedRows=new String[][]{{"REC11","2","2","2"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 	}
1: 	public void testlock()throws Exception
1: 	{
1: 		/*--following puts locks on system table SYSCOLUMNS's row for t1lock.c11
1: 		--Later when a user tries to have the system generate a value for the
1: 		--t1lock.c11, system can't generate that value in a transaction of it's own
1: 		--and hence it reverts to the user transaction to generate the next value.
1: 		--This use of user transaction to generate a value can be problematic if
1: 		--user statement to generate the next value runs into statement rollback.
1: 		--This statement rollback will cause the next value generation to rollback
1: 		--too and system will not be able to consume the generated value. 
1: 		--In a case like this, user can use ALTER TABLE....RESTART WITH to change the
1: 		--start value of the autoincrement column as shown below.*/
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 
1: 		s.execute("insert into t1lock values(1,1)");
1: 		rs=s.executeQuery("select * from t1lock");
1: 		String[][]expectedRows=new String[][]{{"1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'LOCKC11'");
1: 		expectedRows=new String[][]{{"LOCKC11","1","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		assertStatementError("23505",s,"insert into t1lock(c12) values(3)");
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'LOCKC11'");
1: 		//Utilities.showResultSet(rs);
0: 		expectedRows=new String[][]{{"LOCKC11","2","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 		rs=s.executeQuery("select * from t1lock");
1: 		expectedRows=new String[][]{{"1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("alter table t1lock alter column lockc11 restart with 2");
1: 		rs=s.executeQuery("select COLUMNNAME, AUTOINCREMENTVALUE, AUTOINCREMENTSTART, AUTOINCREMENTINC from sys.syscolumns where COLUMNNAME = 'LOCKC11'");
1: 		expectedRows=new String[][]{{"LOCKC11","2","2","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into t1lock(c12) values(3)");
1: 		rs=s.executeQuery("select * from t1lock");
1: 		expectedRows=new String[][]{{"1","1"},{"2","3"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 	}
1: 	public void test_Derby14951465() throws Exception
1: 	{
1: 		ResultSet rs;
1: 		Statement s=createStatement();		
1: 		rs=s.executeQuery("SELECT	col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1495' AND ColumnName = 'TESTID'");
1: 		String[][]expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","1","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("INSERT INTO DERBY_1495(TESTID, TESTCOL2) VALUES(2, 2)");
1: 		s.execute("ALTER TABLE DERBY_1495 ALTER COLUMN TESTid RESTART WITH 3");
1: 		rs=s.executeQuery("SELECT	col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1495' AND ColumnName = 'TESTID'");
1: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","3","3","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 		/*-- Similarly, verify that if we change the INCREMENT BY value for a
1: 		-- GENERATED_BY_DEFAULT column, the column remains GENERATED_BY_DEFAULT
1: 		-- and its START WITH value is preserved.*/
1: 
1: 		rs=s.executeQuery("SELECT col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1645' AND ColumnName = 'TESTTABLEID'");
1: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","1","1","1"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
0: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (1, 'test1')");
0: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (2, 'test2')");
0: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TESTStringValue) VALUES (3, 'test3')");
1: 		s.execute("ALTER TABLE derby_1645 ALTER TESTTableId SET INCREMENT BY 50");
1: 		rs=s.executeQuery("SELECT col.columndefault,col.autoincrementvalue, col.autoincrementstart,col.autoincrementinc FROM sys.syscolumns col INNER JOIN sys.systables tab ON col.referenceId = tab.tableid WHERE tab.tableName = 'DERBY_1645' AND ColumnName = 'TESTTABLEID'");
1: 		expectedRows=new String[][]{{"GENERATED_BY_DEFAULT","53","1","50"}};
1: 		s.execute("INSERT INTO derby_1645 (TESTStringValue) VALUES ('test53')");
1: 		s.execute("INSERT INTO derby_1645 (TESTTableId, TEST" +"StringValue) VALUES (-999, 'test3')");
1: 		s.execute("drop table derby_1645");
1: 
1: 	}
1: 	public void TESTD1644()throws Exception
1: 	{
1: 		/*-- Test cases related to DERBY-1644, which involve:
1: 		--  a) multi-row VALUES clauses
1: 		--  b) GENERATED BY DEFAULT autoincrement fields
1: 		--  c) insert statements which mention only a subset of the table's columns
1: 		-- First we have the actual case from the bug report. Then we have a number
1: 		-- of other similar cases, to try to cover the code area in question*/
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.execute("insert into D1644 (d1644c2) values default, 10");
1: 		s.execute("insert into D1644 (d1644c2) values (11)");
1: 		s.execute("insert into D1644 (d1644c2) values default");
1: 		s.execute("insert into D1644 (d1644c2) values (default)");
1: 		s.execute("insert into D1644 (d1644c2) values 12, 13, 14");
1: 		s.execute("insert into D1644 (d1644c2) values 15, 16, default");
1: 		s.execute("insert into D1644 values (17, 18)");
1: 		s.execute("insert into D1644 values (19, default)");
1: 		s.execute("insert into D1644 values (20, default), (21, 22), (23, 24), (25, default)");
1: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (default, 26)");
1: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (27, 28), (default, 29), (30, 31)");
1: 		s.execute("insert into D1644 (d1644c2) values default, default, default, default");
1: 		s.execute("insert into D1644 (d1644c2, d1644c1) values (default, 128),(default, 129),(default, 131)");
0: 		rs=s.executeQuery("select * from D1644");
0: 		String[][]expectedRows=new String[][]{{null,"1"},	{null,"10"},{null,"11"},{null,"2"},{null,"3"},{null,"12"},{null,"13"},{null,"14"},{null,"15"},{null,"16"},{null,"4"},{"17","18"},{"19","5"},{"20","6"},{"21","22"},{"23","24"},{"25","7"},{"26","8"},{"28","27"},{"29","9"},{"31","30"},{null,"10"},{null,"11"},{null,"12"},{null,"13"},{"128","14"},{"129","15"},{"131","16"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into D1644_A (c3, d1644_Ac1, d1644_Ac2) values (1, 2, default)");
1: 		s.execute("insert into D1644_A (c3, d1644_Ac1, d1644_Ac2) values (3,4,5), (6,7,default)");
1: 		s.execute("insert into D1644_A (c3, d1644_Ac2) values (8, default), (9, 10)");
0: 		rs=s.executeQuery("select * from D1644_A");
0: 		expectedRows=new String[][]{{"2","1","1"},{"4","5","3"},{"7","2","6"},{null,"3","8"},{null,"10","9"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("insert into D1644_B (d1644_Bc1) values default, 10");
1: 		s.execute("insert into D1644_B values default, 10");
0: 		rs=s.executeQuery("select * from D1644_B");
0: 		expectedRows=new String[][]{{"1"},{"10"},{"2"},{"10"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 
1: 
1: 	}
1: 	public void testDerby2902()throws Exception
1: 	{
1: 		/*-- Derby-2902: can't use LONG.MIN_VALUE as the start value for
1: 		-- an identity column. These tests verify that values less than MIN_VALUE
1: 		-- or greater than MAX_VALUE are rejected, but MIN_VALUE and MAX_VALUE
1: 		-- themeselves are accepted.*/
1: 		ResultSet rs;
1: 		Statement s=createStatement();
1: 		s.execute("insert into d4006 values default");
1: 		s.execute("alter table d4006 alter column x with default null");
1: 		s.execute("insert into d4006 values default");
1: 		s.execute("alter table d4006 alter column x with default 'def'");
1: 		s.execute("insert into d4006 values default");
0: 		rs=s.executeQuery("select * from d4006");
0: 		String[][]expectedRows=new String[][]{{"abc"},{null},{"def"}};
1: 		JDBC.assertFullResultSet(rs,expectedRows);
1: 		s.execute("alter table d4006 add column y int generated always as (-1)");
1: 		assertStatementError("42XA7",s,"alter table d4006 alter column y default 42");
1: 		assertStatementError("42XA7",s,"alter table d4006 alter column y default null");
1: 
1: 	}
1: 	
0: 	public static Test suite() {
0: 		return new CleanDatabaseTestSetup(
0: 				new TestSuite(AutoIncrementTest.class, "AutoIncrementTest")) {
1: 			protected void decorateSQL(Statement s)
1: 			throws SQLException
1: 			{
1: 				createSchemaObjects(s);
1: 			}
0: 		};
1: 	}
1: }
============================================================================